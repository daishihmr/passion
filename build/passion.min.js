var SCREEN_WIDTH=360,SCREEN_HEIGHT=640,GAME_AREA_WIDTH=SCREEN_WIDTH,GAME_AREA_HEIGHT=.85*SCREEN_HEIGHT,FPS=60;phina.main(function(){phina.display.DisplayScene.defaults.$extend({width:SCREEN_WIDTH,height:SCREEN_HEIGHT,backgroundColor:"transparent"}),phina.display.Label.defaults.fontFamily="main",phina.display.Label.defaults.fill="white";var t=passion.Application();"localhost"==location.hostname&&t.enableStats(),t.run(),t.replaceScene(phina.game.ManagerScene({scenes:[{className:"phina.game.LoadingScene",arguments:{assets:passion.Assets.get({assetType:"common"})}},{className:"passion.GameScene"}]}))}),phina.namespace(function(){phina.define("passion.Application",{superClass:"phina.display.CanvasApp",init:function(){this.superInit({width:SCREEN_WIDTH,height:SCREEN_HEIGHT,backgroundColor:"#114"}),this.fps=FPS}})}),phina.namespace(function(){phina.define("passion.Assets",{_static:{get:function(t){switch(t.assetType){case"common":return{font:{main:"./asset/font/Baumans/Baumans-Regular.ttf",message:"./asset/font/YasashisaGothic.ttf"},image:{"test2.png":"./asset/image/test2.png","bg.png":"./asset/image/bg.png","bullets.png":"./asset/image/bullets.png","texture0.png":"./asset/image/texture0.png","enemy1.png":"./asset/image/enemy1.png"},vertexShader:{"bullets.vs":"./asset/shader/bullets.vs","sprites.vs":"./asset/shader/sprites.vs"},fragmentShader:{"bullets.fs":"./asset/shader/bullets.fs","sprites.fs":"./asset/shader/sprites.fs"},xml:{simple:"./asset/bulletml/simple.bulletml",test:"./asset/bulletml/test.bulletml"}};default:throw"invalid assetType: "+t.assetType}}}})}),phina.namespace(function(){phina.define("passion.Camera",{position:null,vMatrix:null,pMatrix:null,vpMatrix:null,init:function(){this.position=vec3.create(),this.vMatrix=mat4.create(),this.pMatrix=mat4.create(),this.vpMatrix=mat4.create()},setPosition:function(t,i,e){return vec3.set(this.position,t,i,e),this},lookAt:function(t,i,e){return mat4.lookAt(this.vMatrix,this.position,[t,i,e],[0,1,0]),this},ortho:function(t,i,e,a,s,n){return mat4.ortho(this.pMatrix,t,i,e,a,s,n),this},perspective:function(t,i,e,a){return mat4.perspective(this.pMatrix,t,i,e,a),this},calcVpMatrix:function(){return mat4.mul(this.vpMatrix,this.pMatrix,this.vMatrix),this},uniformValues:function(){return{vpMatrix:this.vpMatrix,cameraPosition:this.position}}})}),phina.namespace(function(){phina.define("passion.Danmaku",{_static:{config:null,setup:function(t){var i=t.player,e=t.bullets,a=t.enemies,s=t.glLayer,n=s.bulletDrawer,h=s.enemyDrawer;return this.config={target:i,createNewBullet:function(t,i){if(i.missile){var r=h.get("enemy");r&&(r.spawn({x:t.x,y:t.y,rotation:t.direction,scaleX:32,scaleY:32,frameX:0,frameY:0,frameW:1/8,frameH:1/8}),r.isMissile=!0,r.runner=t,r.addChildTo(s),a.push(r))}else{var o=n.get();o&&(o.spawn(t,{type:i.type,scale:32}),o.addChildTo(s),e.push(o))}}},this.config}},init:function(){}})}),phina.namespace(function(){phina.define("passion.Background",{superClass:"passion.Sprite",_static:{setup:function(t,i){var e=phina.asset.AssetManager.get("image",i),a=e.domElement.height*GAME_AREA_WIDTH/e.domElement.width,s=phina.graphics.Canvas().setSize(512,512);s.context.drawImage(e.domElement,0,0,512,512),phina.asset.AssetManager.set("image",i+"_bg",s),t.bgDrawer.addObjType("bg",{className:"passion.Background",texture:i+"_bg",count:2});var n=t.bgDrawer.get("bg");n.spawn(a),n.x=GAME_AREA_WIDTH/2,n.y=GAME_AREA_HEIGHT/2,n.addChildTo(t);var h=t.bgDrawer.get("bg");h.spawn(a),h.x=GAME_AREA_WIDTH/2,h.y=GAME_AREA_HEIGHT/2-a,h.addChildTo(t)}},height:0,init:function(t,i,e){this.superInit(t,i,e),this.on("enterframe",function(){this.y+=3,this.y>GAME_AREA_HEIGHT/2+this.height&&(this.y-=2*this.height)})},spawn:function(t){return this.height=t,passion.Sprite.prototype.spawn.call(this,{scaleX:GAME_AREA_WIDTH,scaleY:this.height,frameX:0,frameY:0,frameW:1,frameH:1,red:.5,green:.5,blue:.5}),this}})}),phina.namespace(function(){phina.define("passion.Bullet",{superClass:"phina.app.Element",id:-1,instanceData:null,runner:null,x:0,y:0,age:0,power:0,_active:!1,radius:20,init:function(t,i,e){this.superInit(),this.id=t,this.instanceData=i,this.index=t*e},spawn:function(t,i){var e=this.instanceData,a=this.index;this.runner=t,this.x=t.x,this.y=t.y,this.age=0,e[a+0]=this.x,e[a+1]=this.y,e[a+2]=t.direction,e[a+3]=i.scale,e[a+4]=i.type%8,e[a+5]=~~(i.type/8),e[a+6]=1,e[a+7]=1,e[a+8]=.2+~~(i.type/8)%2,e[a+9]=.2,e[a+10]=.2+~~(i.type/8)%2+1;var s=this;return t.onVanish=function(){s.remove()},this},activate:function(){return this._active=!0,this.flare("activated"),this},inactivate:function(){return this._active=!1,this.flare("inactivated"),this},onremoved:function(){this.instanceData[this.index+6]=0},update:function(t){var i=this.instanceData,e=this.index,a=this.runner;return a.update(),this.x=a.x,this.y=a.y,this.x<-50||GAME_AREA_WIDTH+50<this.x||this.y<-50||GAME_AREA_HEIGHT+50<this.y?void this.remove():(i[e+0]=this.x,i[e+1]=this.y,i[e+7]=1.5+.6*Math.sin(.2*this.age),void(this.age+=1))},hitPlayer:function(t){this.remove()}})}),phina.namespace(function(){phina.define("passion.BulletDrawer",{superClass:"phigl.InstancedDrawable",instanceData:null,pool:null,_count:300,init:function(t,i,e,a){this.superInit(t,i);var s=phigl.Program(t).attach("bullets.vs").attach("bullets.fs").link();this.setProgram(s).setDrawMode(t.TRIANGLE_STRIP).setIndexValues([0,1,2,3]).setAttributes("position","uv").setAttributeDataArray([{unitSize:2,data:[-.5,.5,.5,.5,-.5,-.5,.5,-.5]},{unitSize:2,data:[0,.125,.125,.125,0,0,.125,0]}]).setInstanceAttributes("instancePosition","instanceRotation","instanceScale","instanceFrame","instanceVisible","instanceBrightness","instanceAuraColor").setUniforms("vpMatrix","texture","globalScale");var n=this.instanceStride/4,h=phigl.Texture(t,"bullets.png");this.uniforms.texture.setValue(0).setTexture(h),this.uniforms.globalScale.setValue(1);for(var r=this.instanceData=[],o=0;o<this._count;o++)r.push(0,0,0,1,0,0,0,0,0,0,0);this.setInstanceAttributeData(r);var l=this;this.pool=Array.range(0,this._count).map(function(t){return passion.Bullet(t,r,n).on("removed",function(){l.pool.add(this)})}).toPool(function(t,i){return t.id-i.id})},get:function(){return this.pool.get()},update:function(t){this.setInstanceAttributeData(this.instanceData)},render:function(t){var i=this.gl;i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),this.uniforms.globalScale.value=1,t&&t.forIn(function(t,i){this.uniforms[t]&&(this.uniforms[t].value=i)}.bind(this)),this.draw(this._count)}})}),phina.namespace(function(){phina.define("passion.CircleButton",{superClass:"phina.display.Shape",init:function(t){this.superInit({}.$extend(t,{width:2*t.radius,height:2*t.radius})),this.interactive=!0,this.boundingType="circle",this.radius=t.radius,this.backgroundColor="transparent",this.fill="hsla(190, 100%, 60%, 0.4)",this.stroke="hsla(190, 100%, 60%, 0.9)",this.strokeWidth=2,this.fromJSON({children:{text:{className:"phina.display.Label",arguments:{text:t.text,fontSize:t.fontSize||24,fontFamily:"main"},fill:"hsla(190, 100%, 95%, 0.8)",strokeWidth:0}}})},postrender:function(t){var i=t.context;i.strokeStyle="hsla(190, 100%, 60%, 0.8)",i.beginPath(),i.arc(0,0,.65*this.radius,0,2*Math.PI,!1),i.lineWidth=1,i.fill(),i.stroke(),i.beginPath(),i.arc(0,0,.75*this.radius,0,2*Math.PI,!1),i.lineWidth=3,i.stroke(),i.strokeStyle="hsla(190, 100%, 60%, 0.8)";for(var e,a=0;a<2*Math.PI;)e=Math.randfloat(1,2),i.beginPath(),i.arc(0,0,.9*this.radius,a,a+e,!1),i.lineWidth=1,i.stroke(),a+=1.5*e;i.strokeStyle="hsla(190, 100%, 60%, 0.8)";for(var e,a=0;a<2*Math.PI;)e=Math.randfloat(1,2),i.beginPath(),i.arc(0,0,1*this.radius,a,a+e,!1),i.lineWidth=1,i.stroke(),a+=1.5*e},onpointstart:function(t){this.scaleX=1.2,this.scaleY=1.2},onpointend:function(t){this.scaleX=1,this.scaleY=1,this.hitTest(t.pointer.x,t.pointer.y)&&this.flare("clicked")}})}),phina.namespace(function(){phina.define("passion.Enemy",{superClass:"passion.Sprite",runner:null,hp:0,active:!1,damageRadius:0,attackRadius:0,isMissile:!1,isEntered:!1,init:function(t,i,e){this.superInit(t,i,e),this.on("removed",function(){this.clear("everyframe"),this.clear("damaged"),this.clear("killed"),this.tweener.clear(),this.stopAttack(),this.isMissile=!1,this.isEntered=!1}),this.on("enterframe",function(){if(this.isEntered){if(this.x<-this.damageRadius||GAME_AREA_WIDTH+this.damageRadius<this.x||this.y<-this.damageRadius||GAME_AREA_HEIGHT+this.damageRadius<this.y)return void this.remove()}else this.damageRadius<this.x&&this.x<GAME_AREA_WIDTH-this.damageRadius&&this.damageRadius<this.y&&this.y<GAME_AREA_HEIGHT-this.damageRadius&&(this.isEntered=!0);this.runner&&(this.runner.x=this.x,this.runner.y=this.y,this.runner.update(),this.isMissile&&(this.x=this.runner.x,this.y=this.runner.y))})},spawn:function(t){return passion.Sprite.prototype.spawn.call(this,t),this.hp=t.hp||0,this.damageRadius=t.damageRadius||48,this.attackRadius=t.attackRadius||24,this},startAttack:function(t){var i=phina.asset.AssetManager.get("xml",t),e=bulletml.buildXML(i.data),a=passion.Danmaku.config;this.runner=e.createRunner(a)},stopAttack:function(){this.runner=null}})}),phina.namespace(function(){phina.define("passion.GLLayer",{superClass:"phina.display.Layer",static:{GL_CANVAS:null,GL:null},renderChildBySelf:!0,ready:!1,domElement:null,gl:null,camera:null,bgDrawer:null,enemyDrawer:null,shotDrawer:null,effectDrawer:null,playerDrawer:null,bulletDrawer:null,topEffectDrawer:null,init:function(){this.superInit({width:GAME_AREA_WIDTH,height:GAME_AREA_HEIGHT}),this.originX=0,this.originY=0,null==passion.GLLayer.GL_CANVAS&&(passion.GLLayer.GL_CANVAS=document.createElement("canvas"),passion.GLLayer.GL=passion.GLLayer.GL_CANVAS.getContext("webgl")),this.domElement=passion.GLLayer.GL_CANVAS,this.domElement.width=this.width*passion.GLLayer.quality,this.domElement.height=this.height*passion.GLLayer.quality;var t=this.gl=passion.GLLayer.GL,i=phigl.Extensions.getInstancedArrays(t);t.viewport(0,0,this.domElement.width,this.domElement.height),t.clearColor(0,0,0,1),t.clearDepth(1),t.disable(t.CULL_FACE),t.enable(t.BLEND),t.disable(t.DEPTH_TEST);var e=this.domElement.width,a=this.domElement.height,s=this.width,n=this.height;Math.pow(2,~~Math.log2(e)+1),Math.pow(2,~~Math.log2(a)+1);this.camera=passion.Camera().setPosition(.5*s,.5*n,2e3).lookAt(.5*s,.5*n,0).ortho(.5*-s,.5*s,.5*n,.5*-n,.1,3e3).calcVpMatrix(),this.bgDrawer=passion.SpritDrawer(t,i,s,n),this.enemyDrawer=passion.SpritDrawer(t,i,s,n),this.shotDrawer=passion.SpritDrawer(t,i,s,n),this.effectDrawer=passion.SpritDrawer(t,i,s,n),this.playerDrawer=passion.SpritDrawer(t,i,s,n),this.bulletDrawer=passion.BulletDrawer(t,i,s,n),this.topEffectDrawer=passion.SpritDrawer(t,i,s,n),this.ready=!0},update:function(t){this.ready&&(this.bgDrawer.update(t),this.enemyDrawer.update(t),this.shotDrawer.update(t),this.effectDrawer.update(t),this.playerDrawer.update(t),this.bulletDrawer.update(t),this.topEffectDrawer.update(t))},draw:function(t){if(this.ready){var i=this.gl,e=this.domElement,a=e.width,s=e.height,n=this.camera.uniformValues();i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),this.bgDrawer.render(n),this.shotDrawer.render(n),this.effectDrawer.render(n),this.playerDrawer.render(n),this.enemyDrawer.render(n),this.bulletDrawer.render(n),this.topEffectDrawer.render(n),i.flush();var h=passion.GLLayer.padding;t.context.drawImage(e,0,0,a,s,this.width*h,this.height*h,this.width*(1-2*h),this.height*(1-2*h))}},_static:{padding:.01,quality:1}})}),phina.namespace(function(){phina.define("passion.ParticleEmitter",{superClass:"phina.display.Element",x:0,y:0,glLayer:null,drawer:null,objName:null,spawnOptions:null,genPerFrame:0,init:function(t,i,e,a){this.superInit(),this.glLayer=t,this.drawer=i,this.objName=e,this.spawnOptions=a},update:function(t){for(var i=0;i<this.genPerFrame;i++){var e=this.drawer.get(this.objName);if(!e)break;e.spawn({}.$extend(this.spawnOptions,{x:this.x,y:this.y})),e.addChildTo(this.glLayer)}}}),phina.define("passion.Particle",{superClass:"passion.Sprite",init:function(t,i,e){this.superInit(t,i,e),this.on("removed",function(){this.clear("enterframe"),this.tweener.clear()})}})}),phina.namespace(function(){phina.define("passion.Player",{superClass:"passion.Sprite",_static:{setup:function(t){t.playerDrawer.addObjType("player",{className:"passion.Player",texture:"texture0.png"});var i=t.playerDrawer.get("player");i.spawn(),i.on("enterframe",function(e){if(e.app.ticker.frame%2===0){var a=t.effectDrawer.get("effect"),s=t.effectDrawer.get("effect"),n={x:i.x-8,y:i.y+15,scaleX:18,scaleY:18,frameX:7/8,frameY:0,frameW:1/8,frameH:1/8,red:1,green:1,blue:1,alpha:1},h=function(){this.y+=2,this.alpha*=.8,this.alpha<.01&&this.remove()};a&&(n.x=i.x-8,a.spawn(n),a.onenterframe=h,a.addChildTo(t)),s&&(n.x=i.x+8,s.spawn(n),s.onenterframe=h,s.addChildTo(t))}});var e=t.effectDrawer.get("effect");e.spawn({scaleX:80,scaleY:80,frameX:0,frameY:1/8,frameW:1/8,frameH:1/8,red:2,green:2,blue:2,alpha:.2}),e.addChildTo(t),e.on("enterframe",function(){this.x=i.x,this.y=i.y});var a=t.topEffectDrawer.get("effect");return a.spawn({scaleX:14,scaleY:14,frameX:7/8,frameY:0,frameW:1/8,frameH:1/8,red:.4,green:2,blue:1.6,alpha:1}),a.addChildTo(t),a.on("enterframe",function(){this.x=i.x,this.y=i.y,this.rotation+=.1}),i}},_roll:0,heat:0,heatByShot:0,init:function(t,i,e){this.superInit(t,i,e),this.on("enterframe",function(t){this.controll(t.app)})},spawn:function(){return passion.Sprite.prototype.spawn.call(this,{scaleX:75,scaleY:75,frameX:3/8,frameY:0,frameW:1/8,frameH:1/8,red:1.2,green:1.2,blue:1.2}),this.x=.5*GAME_AREA_WIDTH,this.y=.9*GAME_AREA_HEIGHT,this},controll:function(t){var i=t.pointer,e=i.deltaPosition;(phina.isMobile()||!phina.isMobile()&&i.getPointing())&&(this.x+=2*e.x,this.y+=2*e.y,e.x<0?this.roll-=.2:0<e.x&&(this.roll+=.2),this.x=Math.clamp(this.x,5,GAME_AREA_WIDTH-5),this.y=Math.clamp(this.y,5,GAME_AREA_HEIGHT-5)),0==e.x&&(this.roll*=.9,-.01<this.roll&&this.roll<.01&&(this.roll=0)),i.getPointing()&&this.heat<=0&&(this.flare("fireShot"),this.heat=this.heatByShot),this.heat-=1},_accessor:{roll:{get:function(){return this._roll},set:function(t){this._roll=Math.clamp(t,-3,3);var i=~~this._roll;this.frameX=(i+3)/8}}}})}),phina.namespace(function(){phina.define("passion.Shot",{superClass:"passion.Sprite",bx:0,by:0,init:function(t,i,e){this.superInit(t,i,e),this.on("enterframe",function(t){this.bx=this.x,this.by=this.y,this.controll(t.app)})},controll:function(t){}}),phina.define("passion.NormalShot",{superClass:"passion.Shot",_static:{heatByShot:8,fireCount:3},init:function(t,i,e){this.superInit(t,i,e)},spawn:function(t,i){return passion.Shot.prototype.spawn.call(this,{x:t.x+10*(i-1),y:t.y-30,rotation:.5*-Math.PI,scaleX:48,scaleY:48,frameX:1/8,frameY:1/8,frameW:1/8,frameH:1/8,red:1,green:1,blue:1,alpha:.8}),this},controll:function(t){this.y-=16,this.y<GAME_AREA_HEIGHT*-.1&&this.remove()}}),phina.define("passion.WideShot",{superClass:"passion.Shot",_static:{heatByShot:8,fireCount:3},init:function(t,i,e){this.superInit(t,i,e)},spawn:function(t,i){return passion.Shot.prototype.spawn.call(this,{x:t.x+10*(i-1),y:t.y,rotation:.5*-Math.PI+.2*(i-1),scaleX:48,scaleY:48,frameX:1/8,frameY:1/8,frameW:1/8,frameH:1/8,red:1,green:1,blue:1,alpha:.8}),this},controll:function(t){this.x+=16*Math.cos(this.rotation),this.y+=16*Math.sin(this.rotation),(this.y<GAME_AREA_HEIGHT*-.1||this.x<GAME_AREA_WIDTH*-.1||1.1*GAME_AREA_WIDTH<this.x)&&this.remove()}})}),phina.namespace(function(){phina.define("passion.SpritDrawer",{superClass:"phigl.InstancedDrawable",objTypes:null,objParameters:null,init:function(t,i,e,a){this.superInit(t,i),this.objTypes=[],this.objParameters={};var s=phigl.Program(t).attach("sprites.vs").attach("sprites.fs").link();this.setProgram(s).setDrawMode(t.TRIANGLE_STRIP).setIndexValues([0,1,2,3]).setAttributes("position","uv").setAttributeDataArray([{unitSize:2,data:[-.5,.5,.5,.5,-.5,-.5,.5,-.5]},{unitSize:2,data:[0,1,1,1,0,0,1,0]}]).setInstanceAttributes("instanceVisible","instancePosition","instanceRotation","instanceScale","instanceFrame","instanceColor").setUniforms("vpMatrix","texture","globalScale");this.instanceStride/4;this.uniforms.globalScale.setValue(1)},addObjType:function(t,i){if(i={}.$extend({className:"passion.Sprite",count:1,texture:null,additiveBlending:!1},i),!this.objTypes.contains(t)){var e=this.instanceStride/4;this.objTypes.push(t);var a=this.objParameters[t]={count:i.count,instanceVbo:phigl.Vbo(this.gl,this.gl.DYNAMIC_DRAW),texture:phigl.Texture(this.gl,i.texture),pool:null,additiveBlending:i.additiveBlending,instanceData:Array.range(i.count).map(function(t){return[0,0,0,0,0,0,0,0,0,0,0,0,0,0]}).flatten()},s=phina.using(i.className);a.pool=Array.range(i.count).map(function(t){return s(t,a.instanceData,e).on("removed",function(){a.pool.push(this)})})}},get:function(t){return this.objParameters[t].pool.shift()},update:function(){},render:function(t){if(0!==this.objTypes.length){var i=this.gl;this.uniforms.globalScale.value=1,t&&t.forIn(function(t,i){this.uniforms[t]&&(this.uniforms[t].value=i)}.bind(this));var e=this;this.objTypes.forEach(function(t){var a=e.objParameters[t];a.additiveBlending?i.blendFunc(i.SRC_ALPHA,i.ONE):i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),e.setInstanceAttributeVbo(a.instanceVbo.set(a.instanceData)),e.uniforms.texture.setValue(0).setTexture(a.texture),e.draw(a.count)})}}})}),phina.namespace(function(){phina.define("passion.Sprite",{superClass:"phina.app.Element",id:-1,instanceData:null,visible:!0,x:0,y:0,rotation:0,scale:0,frameX:0,frameY:0,frameW:0,frameH:0,red:1,green:1,blue:1,alpha:1,age:0,init:function(t,i,e){this.superInit(),this.id=t,this.instanceData=i,this.index=t*e},spawn:function(t){t.$safe({visible:!0,x:0,y:0,rotation:0,scaleX:1,scaleY:1,frameX:0,frameY:0,frameW:1/8,frameH:1/8,red:1,green:1,blue:1,alpha:1});var i=this.index,e=this.instanceData;return this.visible=t.visible,this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.frameX=t.frameX,this.frameY=t.frameY,this.frameW=t.frameW,this.frameH=t.frameH,this.red=t.red,this.green=t.green,this.blue=t.blue,this.alpha=t.alpha,e[i+0]=this.visible?1:0,e[i+1]=this.x,e[i+2]=this.y,e[i+3]=this.rotation,e[i+4]=this.scaleX,e[i+5]=this.scaleY,e[i+6]=this.frameX,e[i+7]=this.frameY,e[i+8]=this.frameW,e[i+9]=this.frameH,e[i+10]=this.red,e[i+11]=this.green,e[i+12]=this.blue,e[i+13]=this.alpha,this.age=0,this},update:function(t){var i=this.index,e=this.instanceData;e[i+0]=this.visible?1:0,e[i+1]=this.x,e[i+2]=this.y,e[i+3]=this.rotation,e[i+4]=this.scaleX,e[i+5]=this.scaleY,e[i+6]=this.frameX,e[i+7]=this.frameY,e[i+8]=this.frameW,e[i+9]=this.frameH,e[i+10]=this.red,e[i+11]=this.green,e[i+12]=this.blue,e[i+13]=this.alpha,this.age+=1},onremoved:function(){this.visible=!1,this.instanceData[this.index+0]=0}})}),phina.namespace(function(){phina.define("passion.UIFrame",{superClass:"phina.display.Shape",init:function(t){this.superInit(t),this.backgroundColor="transparent",this.strokeWidth=2},prerender:function(t){var i=t.context;i.beginPath(),i.moveTo(-this.width/2+10,-this.height/2),i.lineTo(this.width/2-5,-this.height/2),i.lineTo(this.width/2,-this.height/2+5),i.lineTo(this.width/2,this.height/2-10),i.lineTo(this.width/2-10,this.height/2),i.lineTo(-this.width/2+35,this.height/2),i.lineTo(-this.width/2+30,this.height/2-5),i.lineTo(-this.width/2,this.height/2-5),i.lineTo(-this.width/2,10-this.height/2),i.closePath();var e=i.createLinearGradient(this.height/2,-this.width/2,-this.height/2,this.width/2);e.addColorStop(0,"hsla(190, 100%, 30%, 0.8)"),e.addColorStop(.38,"hsla(190, 100%, 30%, 0.8)"),e.addColorStop(.48,"hsla(190, 100%, 80%, 0.8)"),e.addColorStop(.52,"hsla(190, 100%, 80%, 0.8)"),e.addColorStop(.62,"hsla(190, 100%, 30%, 0.8)"),e.addColorStop(1,"hsla(190, 100%, 30%, 0.8)"),this.stroke=e;var a=i.createLinearGradient(this.height/2,-this.width/2,-this.height/2,this.width/2);a.addColorStop(0,"hsla(210, 100%, 30%, 0.2)"),a.addColorStop(.38,"hsla(210, 100%, 30%, 0.2)"),a.addColorStop(.48,"hsla(210, 100%, 80%, 0.2)"),a.addColorStop(.52,"hsla(210, 100%, 80%, 0.2)"),a.addColorStop(.62,"hsla(210, 100%, 30%, 0.2)"),a.addColorStop(1,"hsla(210, 100%, 30%, 0.2)"),this.fill=a},postrender:function(t){var i=t.context;i.beginPath(),i.moveTo(-this.width/2+10-3,-this.height/2-3),i.lineTo(this.width/2-5+3,-this.height/2-3),i.lineTo(this.width/2+3,-this.height/2+5-3),i.lineTo(this.width/2+3,this.height/2-10+3),i.lineTo(this.width/2-10+3,this.height/2+3),i.lineTo(-this.width/2+35-3,this.height/2+3),i.lineTo(-this.width/2+30-3,this.height/2-5+3),i.lineTo(-this.width/2-3,this.height/2-5+3),i.lineTo(-this.width/2-3,-this.height/2+10-3),i.closePath(),i.lineWidth=1,i.stroke()}})}),phina.namespace(function(){phina.define("passion.UIHeadLabel",{superClass:"phina.display.Shape",init:function(t){this.superInit(t),this.backgroundColor="transparent",this.stroke="hsla(190, 100%, 60%, 1.0)",this.strokeWidth=1,this.fromJSON({children:{text:{className:"phina.display.Label",arguments:{text:t.text,fontSize:t.fontSize||24,fontFamily:t.fontFamily||"main",align:t.align||"center"},fill:"hsla(190, 100%, 95%, 0.8)",strokeWidth:0}}})},prerender:function(t){var i=t.context,e=i.createLinearGradient(0,-this.height/2,0,this.height/2);e.addColorStop(0,"hsla(190, 100%, 50%, 0.2)"),e.addColorStop(.4,"hsla(190, 100%, 30%, 0.2)"),e.addColorStop(.6,"hsla(190, 100%, 30%, 0.2)"),e.addColorStop(1,"hsla(190, 100%, 50%, 0.2)"),this.fill=e},postrender:function(t){var i=t.context;i.beginPath(),i.moveTo(-this.width/2,this.height/2),i.lineTo(-this.width/2,-this.height/2+10),i.lineTo(-this.width/2+10,-this.height/2),i.lineTo(this.width/2,-this.height/2),i.lineTo(this.width/2,this.height/2-10),i.lineTo(this.width/2-10,this.height/2),i.closePath(),i.fill(),i.beginPath(),i.moveTo(-this.width/2,this.height/2),i.lineTo(-this.width/2,-this.height/2+10),i.lineTo(-this.width/2+10,-this.height/2),i.stroke(),i.beginPath(),i.moveTo(this.width/2,-this.height/2),i.lineTo(this.width/2,this.height/2-10),i.lineTo(this.width/2-10,this.height/2),i.stroke()}})}),phina.namespace(function(){phina.define("passion.UIHead2Label",{superClass:"phina.display.Shape",init:function(t){this.superInit(t),this.backgroundColor="transparent",this.strokeWidth=1,this.fromJSON({children:{text:{className:"phina.display.Label",arguments:{text:t.text,fontSize:t.fontSize||24,fontFamily:t.fontFamily||"main",align:t.align||"center"},fill:"hsla(190, 100%, 95%, 0.8)",strokeWidth:0}}})},prerender:function(t){var i=t.context,e=i.createLinearGradient(0,-this.height/2,0,this.height/2);e.addColorStop(0,"hsla(190, 100%, 50%, 0.2)"),e.addColorStop(.4,"hsla(190, 100%, 30%, 0.2)"),e.addColorStop(.6,"hsla(190, 100%, 30%, 0.2)"),e.addColorStop(1,"hsla(190, 100%, 50%, 0.2)"),this.fill=e;var a=i.createLinearGradient(-this.width/2,0,this.width/2,0);a.addColorStop(0,"hsla(190, 100%, 60%, 0.0)"),a.addColorStop(.3,"hsla(190, 100%, 60%, 1.0)"),a.addColorStop(.7,"hsla(190, 100%, 60%, 1.0)"),a.addColorStop(1,"hsla(190, 100%, 60%, 0.0)"),this.stroke=a},postrender:function(t){var i=t.context;i.beginPath(),i.moveTo(-this.width/2,this.height/2),i.lineTo(-this.width/2,-this.height/2),i.lineTo(this.width/2,-this.height/2),i.lineTo(this.width/2,this.height/2),i.closePath(),i.fill(),i.beginPath(),i.moveTo(-this.width/2,this.height/2),i.lineTo(this.width/2,this.height/2),i.stroke(),i.beginPath(),i.moveTo(-this.width/2,-this.height/2),i.lineTo(this.width/2,-this.height/2),i.stroke()}})}),phina.namespace(function(){phina.define("passion.UILayer",{superClass:"phina.display.DisplayElement",init:function(t){this.superInit(),this.fromJSON({originX:0,originY:0,children:{damage:{className:"phina.display.Sprite",arguments:this.damageTexture(),originX:0,originY:0,alpha:0,x:GAME_AREA_WIDTH*passion.GLLayer.padding,y:GAME_AREA_HEIGHT*passion.GLLayer.padding},scoreBg:{className:"passion.UIFrame",arguments:{width:.96*SCREEN_WIDTH,height:.05*SCREEN_HEIGHT},x:0*SCREEN_WIDTH,y:0*SCREEN_HEIGHT,originX:0,originY:0,children:{scoreLabel:{className:"phina.display.Label",arguments:{text:"9,991,234,567,890",align:"right",baseline:"middle",fontSize:.035*SCREEN_HEIGHT},x:.96*SCREEN_WIDTH,y:.038*SCREEN_HEIGHT},hi:{className:"phina.display.Label",arguments:{text:"HI",align:"left",baseline:"middle",fontSize:.025*SCREEN_HEIGHT},x:.04*SCREEN_WIDTH,y:.035*SCREEN_HEIGHT},highscoreLabel:{className:"phina.display.Label",arguments:{text:"9,991,234,567,890",align:"right",baseline:"middle",fontSize:.025*SCREEN_HEIGHT},x:.44*SCREEN_WIDTH,y:.035*SCREEN_HEIGHT}}},bombButton:{className:"passion.CircleButton",arguments:{text:"BOMB",fontSize:15,radius:.09*GAME_AREA_WIDTH},x:.1*GAME_AREA_WIDTH,y:.93*GAME_AREA_HEIGHT},messageWindow:{className:"passion.UIFrame",arguments:{width:.96*SCREEN_WIDTH,height:.14*SCREEN_HEIGHT},x:0*SCREEN_WIDTH,y:.84*SCREEN_HEIGHT,originX:0,originY:0,children:{nameLabel:{className:"passion.UIHead2Label",arguments:{text:"オペ子",width:.3*SCREEN_WIDTH,height:.03*SCREEN_HEIGHT,fontSize:18,fontFamily:"main, message"},x:.2*SCREEN_WIDTH,y:.034*SCREEN_HEIGHT},mesasgeLabel:{className:"phina.display.Label",arguments:{text:"WARNING!!\n今までにない強大な力が近づいてきます！\n気をつけてください！！",align:"left",baseline:"top",fontSize:16,lineHeight:1.1,fontFamily:"main, message"},x:.05*SCREEN_WIDTH,y:.076*SCREEN_HEIGHT}}},test:{className:"phina.display.Sprite",arguments:"test2.png",x:1*SCREEN_WIDTH,y:.84*SCREEN_HEIGHT,originX:1,originY:1,visible:!1}}});var i=this;t.on("updateScore",function(){i.scoreBg.scoreLabel.text=passion.Utils.sep(this.score),this.highScore<this.score&&(i.scoreBg.highscoreLabel.text=passion.Utils.sep(this.highScore))}),t.on("damage",function(t){})},damageTexture:function(){var t=phina.graphics.Canvas(),i=passion.GLLayer.padding;t.setSize(GAME_AREA_WIDTH*(1-2*i),GAME_AREA_HEIGHT*(1-2*i)),t.clearColor("transparent");var e=t.context.createRadialGradient(t.width/2,t.height/2,0,t.width/2,t.height/2,t.height/2);return e.addColorStop(0,"rgba(255, 0, 0, 0.0)"),e.addColorStop(1,"rgba(255, 0, 0, 1.0)"),t.fillStyle=e,t.fillRect(0,0,t.width,t.height),t}})}),phina.namespace(function(){phina.define("passion.GameManager",{superClass:"phina.util.EventDispatcher",score:0,highScore:0,init:function(){this.superInit()}})}),phina.namespace(function(){phina.define("passion.Pool",{array:null,dirty:null,comparator:null,init:function(t,i){this.array=t||[],this.comparator=i||function(t,i){return t-i},this.dirty=!0},add:function(t){this.array.push(t),this.dirty=!0},get:function(){return this.dirty&&(this.array.sort(this.comparator),this.dirty=!1),this.array.shift()}}),Array.prototype.$method("toPool",function(t){return passion.Pool(this,t)})}),phina.namespace(function(){phina.define("passion.GameScene",{superClass:"phina.display.DisplayScene",gameManager:null,shots:null,enemies:null,bullets:null,init:function(){this.superInit();this.gameManager=passion.GameManager(),this.shots=[],this.enemies=[],this.bullets=[];this.fromJSON({children:{bg:{className:"phina.display.Sprite",arguments:this.drawBgTexture(),originX:0,originY:0},glLayer:{className:"passion.GLLayer"},uiLayer:{className:"passion.UILayer",arguments:this.gameManager}}});var t=this.glLayer;t.effectDrawer.addObjType("effect",{texture:"texture0.png",additiveBlending:!0,count:200}),t.topEffectDrawer.addObjType("effect",{texture:"texture0.png",count:2}),passion.Background.setup(t,"bg.png",1069);var i=this.player=passion.Player.setup(t).addChildTo(t),e="passion.WideShot";t.shotDrawer.addObjType("shot",{className:e,texture:"bullets.png",count:50});var a=phina.using(e);i.heatByShot=a.heatByShot,i.on("fireShot",function(i){for(var e=0;e<a.fireCount;e++){var s=t.shotDrawer.get("shot");s&&s.spawn(this,e).addChildTo(t)}}),t.enemyDrawer.addObjType("enemy",{className:"passion.Enemy",texture:"enemy1.png",count:50}),passion.Danmaku.setup(this)},update:function(t){for(var i=this.enemies,e=0;e<i.length;e++)i[e].flare("everyframe",{player:this.player,enemies:this.enemies})},drawBgTexture:function(){var t=phina.graphics.Canvas();return t.setSize(SCREEN_WIDTH,SCREEN_HEIGHT),t.clearColor("hsla(190, 100%, 95%, 0.05)"),150..times(function(i,e){var a=1.5*SCREEN_HEIGHT/e*i;t.strokeStyle="hsla(190, 100%, 95%, 0.1)",t.strokeLines(0*SCREEN_WIDTH,a-10,.1*SCREEN_WIDTH,a-10,.2*SCREEN_WIDTH,a+20,.5*SCREEN_WIDTH,a+20,.6*SCREEN_WIDTH,a-30,.7*SCREEN_WIDTH,a-30,.8*SCREEN_WIDTH,a-50,1*SCREEN_WIDTH,a-50),t.strokeStyle="hsla(190, 100%, 65%, 0.1)",a+=1,t.strokeLines(0*SCREEN_WIDTH,a-10,.1*SCREEN_WIDTH,a-10,.2*SCREEN_WIDTH,a+20,.5*SCREEN_WIDTH,a+20,.6*SCREEN_WIDTH,a-30,.7*SCREEN_WIDTH,a-30,.8*SCREEN_WIDTH,a-50,1*SCREEN_WIDTH,a-50),t.strokeStyle="hsla(190, 100%, 35%, 0.1)",a+=1,t.strokeLines(0*SCREEN_WIDTH,a-10,.1*SCREEN_WIDTH,a-10,.2*SCREEN_WIDTH,a+20,.5*SCREEN_WIDTH,a+20,.6*SCREEN_WIDTH,a-30,.7*SCREEN_WIDTH,a-30,.8*SCREEN_WIDTH,a-50,1*SCREEN_WIDTH,a-50)}),t}})}),phina.namespace(function(){phina.define("passion.Utils",{_static:{sep:function(t){return(""+Math.floor(t)).replace(/(\d)(?=(\d{3})+$)/g,"$1,")}},init:function(){}})});