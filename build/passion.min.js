var SCREEN_WIDTH=360,SCREEN_HEIGHT=640,GAME_AREA_WIDTH=SCREEN_WIDTH,GAME_AREA_HEIGHT=.85*SCREEN_HEIGHT,FPS=60;phina.main(function(){phina.display.DisplayScene.defaults.$extend({width:SCREEN_WIDTH,height:SCREEN_HEIGHT,backgroundColor:"transparent"}),phina.display.Label.defaults.fontFamily="main",phina.display.Label.defaults.fill="white",phina.asset.SoundManager.volume=.05,phina.asset.SoundManager.musicVolume=.05;var t=passion.Application();"localhost"!=location.hostname&&"private.dev7.jp"!=location.hostname||t.enableStats(),t.run(),t.replaceScene(phina.game.ManagerScene({scenes:[{className:"phina.game.LoadingScene",arguments:{assets:passion.Assets.get({assetType:"common"})}},{className:"passion.StageAssetLoadScene",arguments:{stage:"testStage"}},{className:"passion.GameScene"}]}))}),phina.namespace(function(){phina.define("passion.Application",{superClass:"phina.display.CanvasApp",init:function(){this.superInit({width:SCREEN_WIDTH,height:SCREEN_HEIGHT,backgroundColor:"#114"}),this.fps=FPS,this.keyboardEx=passion.Keyboard(document),this.keyboardEx.on("keydown",function(t){this.currentScene&&this.currentScene.flare("keydown",{keyCode:t.keyCode})}.bind(this)),this.keyboardEx.on("keyup",function(t){this.currentScene&&this.currentScene.flare("keyup",{keyCode:t.keyCode})}.bind(this)),this.keyboardEx.on("keypress",function(t){this.currentScene&&this.currentScene.flare("keypress",{keyCode:t.keyCode})}.bind(this)),this.gamepadManager=passion.GamepadManager()},update:function(){this.keyboardEx.update(),this.gamepadManager.update()}})}),phina.namespace(function(){phina.define("passion.Assets",{_static:{get:function(t){switch(t.assetType){case"common":return{font:{main:"./asset/font/Baumans/Baumans-Regular.ttf",message:"./asset/font/YasashisaGothic.ttf"},image:{"bullets.png":"./asset/image/bullets.png","bullets_erase.png":"./asset/image/bullets_erase.png","texture0.png":"./asset/image/texture0.png","effect.png":"./asset/image/effect.png"},vertexShader:{"bullets.vs":"./asset/shader/bullets.vs","sprites.vs":"./asset/shader/sprites.vs"},fragmentShader:{"bullets.fs":"./asset/shader/bullets.fs","sprites.fs":"./asset/shader/sprites.fs"},sound:{home:"./asset/sound/nc136160.mp3",shot:"./asset/sound/sen_ge_kijuu01.mp3"}};default:throw"invalid assetType: "+t.assetType}}}})}),phina.namespace(function(){phina.define("passion.Camera",{position:null,vMatrix:null,pMatrix:null,vpMatrix:null,init:function(){this.position=vec3.create(),this.vMatrix=mat4.create(),this.pMatrix=mat4.create(),this.vpMatrix=mat4.create()},setPosition:function(t,e,i){return vec3.set(this.position,t,e,i),this},lookAt:function(t,e,i){return mat4.lookAt(this.vMatrix,this.position,[t,e,i],[0,1,0]),this},ortho:function(t,e,i,n,s,a){return mat4.ortho(this.pMatrix,t,e,i,n,s,a),this},perspective:function(t,e,i,n){return mat4.perspective(this.pMatrix,t,e,i,n),this},calcVpMatrix:function(){return mat4.mul(this.vpMatrix,this.pMatrix,this.vMatrix),this},uniformValues:function(){return{vpMatrix:this.vpMatrix,cameraPosition:this.position}}})}),phina.namespace(function(){phina.define("passion.Danmaku",{_static:{config:null,setup:function(t){var e=t.player,i=(t.bullets,t.enemies,t.glLayer),n=i.bulletDrawer;i.enemyDrawer;return bulletml.Walker.random=function(){return t.random.random()},this.config={target:e,createNewBullet:function(e,i){var s=n.get();s&&(s.spawn({type:i.type,scale:32}),s.bulletRunning.setRunner(e),t.flare("spawnBullet",{bullet:s}))}},this.config},createRunner:function(t){var e=phina.asset.AssetManager.get("xml",t),i=bulletml.buildXML(e.data),n=passion.Danmaku.config;return i.createRunner(n)}},init:function(){}}),phina.asset.AssetLoader.assetLoadFunctions.bulletml=phina.asset.AssetLoader.assetLoadFunctions.xml}),phina.namespace(function(){phina.define("passion.Background",{superClass:"passion.Sprite",_static:{setup:function(t,e){var i=phina.asset.AssetManager.get("image",e),n=i.domElement.height*GAME_AREA_WIDTH/i.domElement.width,s=phina.graphics.Canvas().setSize(512,512);s.context.drawImage(i.domElement,0,0,512,512),phina.asset.AssetManager.set("image",e+"_bg",s),t.bgDrawer.addObjType("bg",{className:"passion.Background",texture:e+"_bg",count:2});var a=t.bgDrawer.get("bg");a.spawn(n),a.x=GAME_AREA_WIDTH/2,a.y=GAME_AREA_HEIGHT/2,a.addChildTo(t);var h=t.bgDrawer.get("bg");h.spawn(n),h.x=GAME_AREA_WIDTH/2,h.y=GAME_AREA_HEIGHT/2-n,h.addChildTo(t)}},height:0,init:function(t,e,i){this.superInit(t,e,i),this.on("enterframe",function(){this.y+=3,this.y>GAME_AREA_HEIGHT/2+this.height&&(this.y-=2*this.height)})},spawn:function(t){return this.height=t,this.superMethod("spawn",{scaleX:GAME_AREA_WIDTH,scaleY:this.height,frameX:0,frameY:0,frameW:1,frameH:1,red:.5,green:.5,blue:.5}),this}})}),phina.namespace(function(){phina.define("passion.Bullet",{superClass:"phina.app.Element",id:-1,instanceData:null,x:0,y:0,age:0,power:0,_active:!1,radius:20,_bulletRunning:null,init:function(t,e,i){this.superInit(),this.id=t,this.instanceData=e,this.index=t*i},spawn:function(t){this.instanceData,this.index;return this.age=0,this.scale=t.scale,this.frameX=t.type%8,this.frameY=~~(t.type/8),this.visible=!0,this.brightness=1,this.auraRed=.2+~~(t.type/8)%2,this.auraGreen=.2,this.auraBlue=.2+~~(t.type/8)%2+1,this},activate:function(){return this._active=!0,this.flare("activated"),this},inactivate:function(){return this._active=!1,this.flare("inactivated"),this},onremoved:function(){this.visible=!1,this.bulletRunning.setRunner(null)},update:function(t){this.instanceData,this.index;return this.brightness=1.5+.6*Math.sin(.2*this.age),this.x<-50||GAME_AREA_WIDTH+50<this.x||this.y<-50||GAME_AREA_HEIGHT+50<this.y?void this.remove():void(this.age+=1)},isHit:function(t){return!(!this.visible||!t.visible)&&(this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y)<25},_accessor:{x:{get:function(){return this.instanceData[this.index+0]},set:function(t){this.instanceData[this.index+0]=t}},y:{get:function(){return this.instanceData[this.index+1]},set:function(t){this.instanceData[this.index+1]=t}},rotation:{get:function(){return this.instanceData[this.index+2]},set:function(t){this.instanceData[this.index+2]=t}},scale:{get:function(){return this.instanceData[this.index+3]},set:function(t){this.instanceData[this.index+3]=t}},frameX:{get:function(){return this.instanceData[this.index+4]},set:function(t){this.instanceData[this.index+4]=t}},frameY:{get:function(){return this.instanceData[this.index+5]},set:function(t){this.instanceData[this.index+5]=t}},visible:{get:function(){return 1==this.instanceData[this.index+6]},set:function(t){this.instanceData[this.index+6]=t?1:0}},brightness:{get:function(){return this.instanceData[this.index+7]},set:function(t){this.instanceData[this.index+7]=t}},auraRed:{get:function(){return this.instanceData[this.index+8]},set:function(t){this.instanceData[this.index+8]=t}},auraGreen:{get:function(){return this.instanceData[this.index+9]},set:function(t){this.instanceData[this.index+9]=t}},auraBlue:{get:function(){return this.instanceData[this.index+10]},set:function(t){this.instanceData[this.index+10]=t}}}}),passion.Bullet.prototype.getter("bulletRunning",function(){return this._bulletRunning||(this._bulletRunning=passion.BulletRunning().attachTo(this)),this._bulletRunning})}),phina.namespace(function(){phina.define("passion.BulletDrawer",{superClass:"phigl.InstancedDrawable",instanceData:null,pool:null,_count:3e3,init:function(t,e,i,n){this.superInit(t,e);var s=phigl.Program(t).attach("bullets.vs").attach("bullets.fs").link();this.setProgram(s).setDrawMode(t.TRIANGLE_STRIP).setIndexValues([0,1,2,3]).setAttributes("position","uv").setAttributeDataArray([{unitSize:2,data:[-.5,.5,.5,.5,-.5,-.5,.5,-.5]},{unitSize:2,data:[0,.125,.125,.125,0,0,.125,0]}]).setInstanceAttributes("instancePosition","instanceRotation","instanceScale","instanceFrame","instanceVisible","instanceBrightness","instanceAuraColor").setUniforms("vpMatrix","texture","globalScale");var a=this.instanceStride/4,h=phigl.Texture(t,"bullets.png");this.uniforms.texture.setValue(0).setTexture(h),this.uniforms.globalScale.setValue(1);for(var r=this.instanceData=[],o=0;o<this._count;o++)r.push(0,0,0,1,0,0,0,0,0,0,0);this.setInstanceAttributeData(r);var l=this;this.pool=Array.range(0,this._count).map(function(t){return passion.Bullet(t,r,a).on("removed",function(){l.pool.add(this)})}).toPool(function(t,e){return t.id-e.id})},get:function(){return this.pool.get()},update:function(t){this.setInstanceAttributeData(this.instanceData)},render:function(t){var e=this.gl;e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),this.uniforms.globalScale.value=1,t&&t.forIn(function(t,e){this.uniforms[t]&&(this.uniforms[t].value=e)}.bind(this)),this.draw(this._count)}})}),phina.namespace(function(){phina.define("passion.BulletEraseEffect",{superClass:"passion.Sprite",init:function(t,e,i){this.superInit(t,e,i),this.on("enterframe",function(t){t.app.ticker.frame%2===0&&(this.frameX+=1/8,this.frameX>=1&&this.remove())})},spawn:function(t){return this.superMethod("spawn",{}.$extend(t,{frameX:0,frameY:1/8,frameW:1/8,frameH:1/8,scaleX:64,scaleY:64,alpha:1})),this}})}),phina.namespace(function(){phina.define("passion.CircleButton",{superClass:"phina.display.Shape",init:function(t){this.superInit({}.$extend(t,{width:2*t.radius,height:2*t.radius})),this.interactive=!0,this.boundingType="circle",this.radius=t.radius,this.backgroundColor="transparent",this.fill="hsla(190, 100%, 60%, 0.4)",this.stroke="hsla(190, 100%, 60%, 0.9)",this.strokeWidth=2,this.fromJSON({children:{text:{className:"phina.display.Label",arguments:{text:t.text,fontSize:t.fontSize||24,fontFamily:"main"},fill:"hsla(190, 100%, 95%, 0.8)",strokeWidth:0}}})},postrender:function(t){var e=t.context;e.strokeStyle="hsla(190, 100%, 60%, 0.8)",e.beginPath(),e.arc(0,0,.65*this.radius,0,2*Math.PI,!1),e.lineWidth=1,e.fill(),e.stroke(),e.beginPath(),e.arc(0,0,.75*this.radius,0,2*Math.PI,!1),e.lineWidth=3,e.stroke(),e.strokeStyle="hsla(190, 100%, 60%, 0.8)";for(var i,n=0;n<2*Math.PI;)i=Math.randfloat(1,2),e.beginPath(),e.arc(0,0,.9*this.radius,n,n+i,!1),e.lineWidth=1,e.stroke(),n+=1.5*i;e.strokeStyle="hsla(190, 100%, 60%, 0.8)";for(var i,n=0;n<2*Math.PI;)i=Math.randfloat(1,2),e.beginPath(),e.arc(0,0,1*this.radius,n,n+i,!1),e.lineWidth=1,e.stroke(),n+=1.5*i},onpointstart:function(t){this.scaleX=1.2,this.scaleY=1.2},onpointend:function(t){this.scaleX=1,this.scaleY=1,this.hitTest(t.pointer.x,t.pointer.y)&&this.flare("clicked")}})}),phina.namespace(function(){phina.define("passion.Enemy",{superClass:"passion.Sprite",motionRunner:null,attackRunner:null,status:-1,hp:0,hitRadius:0,expType:null,waitTime:0,bx:0,by:0,init:function(t,e,i){this.superInit(t,e,i),this.on("spawned",function(){this.status=0}),this.on("activated",function(){this.status=1}),this.on("entered",function(){this.status=2}),this.on("killed",function(t){this.status=3}),this.on("removed",function(){this.clear("damaged"),this.tweener.clear(),this.motionRunner=null,this.attackRunner=null,this.status=-1,this.waitTime=0}),this.on("enterframe",function(){if(0===this.status)this.waitTime-=1,this.waitTime<=0&&this.flare("activated");else if(1===this.status)this.hitRadius<this.x&&this.x<GAME_AREA_WIDTH-this.hitRadius&&this.hitRadius<this.y&&this.y<GAME_AREA_HEIGHT-this.hitRadius&&this.flare("entered");else if((2===this.status||3===this.status)&&(this.x<-this.hitRadius||GAME_AREA_WIDTH+this.hitRadius<this.x||this.y<-this.hitRadius||GAME_AREA_HEIGHT+this.hitRadius<this.y))return void this.remove();0<this.status&&this.status<3&&this.motionRunner&&(this.bx=this.x,this.by=this.y,this.motionRunner.update(),this.x=this.motionRunner.x,this.y=this.motionRunner.y,this.rot&&(this.rotation=this.motionRunner.direction-.5*Math.PI)),2===this.status&&(!this.rot||this.y<passion.Danmaku.config.target.y)&&this.attackRunner&&(this.attackRunner.x=this.x,this.attackRunner.y=this.y,this.attackRunner.update())})},spawn:function(t){return this.superMethod("spawn",t),this.hp=t.hp||0,this.hitRadius=t.hitRadius||24,this.expType=t.expType||"small",t.motion&&(this.motionRunner=passion.Danmaku.createRunner("motion/"+t.motion),this.motionRunner.x=this.x,this.motionRunner.y=this.y),t.attack&&(this.attackRunner=passion.Danmaku.createRunner("attack/"+t.attack),this.attackRunner.x=this.x,this.attackRunner.y=this.y),this.hp=t.hp,this.waitTime=t.wait||0,this.rot=t.rot||!1,t.muteki||this.on("damaged",function(t){var e=t.shot;this.hp-=e.power,this.hp<=0&&this.flare("killed")}),this.flare("spawned"),this},playKilledEffect:function(t){switch(this.expType){case"small":default:this.remove(),t.flare("spawnParticle",{className:"passion.ExplosionSmall",x:this.x,y:this.y})}},isHit:function(t){return!(!t.visible||2!=this.status||this.hp<=0)&&(this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y)<this.hitRadius*this.hitRadius}})}),phina.namespace(function(){phina.define("passion.ExplosionLarge",{superClass:"passion.ParticleEmitter",init:function(t,e){this.superInit(t,e,"particle",{frameX:7/8,frameY:0,frameW:1/8,frameH:1/8,red:1,green:.8,blue:.2,alpha:.8,scaleX:10,scaleY:10}),this.tweener.clear().set({genPerFrame:5}).to({genPerFrame:0},100).call(function(){this.remove()}.bind(this))},onspawnParticle:function(t){var e=t.particle,i=Math.random()*Math.PI*2,n=Math.randint(2,25);e.tweener.clear().to({x:e.x+Math.cos(i)*n,y:e.y+Math.sin(i)*n,scaleX:50,scaleY:50,green:0,blue:0,alpha:0},400).call(function(){this.remove()}.bind(e))}})}),phina.namespace(function(){phina.define("passion.ExplosionSmall",{superClass:"passion.ParticleEmitter",init:function(t,e){this.superInit(t,e,"particle",{frameX:7/8,frameY:0,frameW:1/8,frameH:1/8,red:1,green:.8,blue:.2,alpha:.8,scaleX:10,scaleY:10}),this.tweener.clear().set({genPerFrame:5}).to({genPerFrame:0},150).call(function(){this.remove()}.bind(this))},onspawnParticle:function(t){var e=t.particle,i=Math.random()*Math.PI*2,n=Math.randint(2,25);e.tweener.clear().to({x:e.x+Math.cos(i)*n,y:e.y+Math.sin(i)*n,scaleX:50,scaleY:50,green:0,blue:0,alpha:0},400,"easeOutQuad").call(function(){this.remove()}.bind(e))}})}),phina.namespace(function(){phina.define("passion.GLLayer",{superClass:"phina.display.Layer",renderChildBySelf:!0,ready:!1,domElement:null,gl:null,camera:null,bgDrawer:null,enemyDrawer:null,shotDrawer:null,effectDrawer:null,playerDrawer:null,bulletDrawer:null,topEffectDrawer:null,init:function(){this.superInit({width:GAME_AREA_WIDTH,height:GAME_AREA_HEIGHT}),this.originX=0,this.originY=0,null==passion.GLLayer.GL_CANVAS&&(passion.GLLayer.GL_CANVAS=document.createElement("canvas"),passion.GLLayer.GL=passion.GLLayer.GL_CANVAS.getContext("webgl")),this.domElement=passion.GLLayer.GL_CANVAS,this.domElement.width=this.width*passion.GLLayer.quality,this.domElement.height=this.height*passion.GLLayer.quality;var t=this.gl=passion.GLLayer.GL,e=phigl.Extensions.getInstancedArrays(t);t.viewport(0,0,this.domElement.width,this.domElement.height),t.clearColor(0,0,0,1),t.clearDepth(1),t.disable(t.CULL_FACE),t.enable(t.BLEND),t.disable(t.DEPTH_TEST);var i=this.domElement.width,n=this.domElement.height,s=this.width,a=this.height;Math.pow(2,~~Math.log2(i)+1),Math.pow(2,~~Math.log2(n)+1);this.camera=passion.Camera().setPosition(.5*s,.5*a,2e3).lookAt(.5*s,.5*a,0).ortho(.5*-s,.5*s,.5*a,.5*-a,.1,3e3).calcVpMatrix(),this.bgDrawer=passion.SpritDrawer(t,e,s,a),this.enemyDrawer=passion.SpritDrawer(t,e,s,a),this.shotDrawer=passion.SpritDrawer(t,e,s,a),this.effectDrawer=passion.SpritDrawer(t,e,s,a),this.playerDrawer=passion.SpritDrawer(t,e,s,a),this.bulletDrawer=passion.BulletDrawer(t,e,s,a),this.topEffectDrawer=passion.SpritDrawer(t,e,s,a),this.ready=!0},update:function(t){this.ready&&(this.bgDrawer.update(t),this.enemyDrawer.update(t),this.shotDrawer.update(t),this.effectDrawer.update(t),this.playerDrawer.update(t),this.bulletDrawer.update(t),this.topEffectDrawer.update(t))},draw:function(t){if(this.ready){var e=this.gl,i=this.domElement,n=i.width,s=i.height,a=this.camera.uniformValues();e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this.bgDrawer.render(a),this.effectDrawer.render(a),this.enemyDrawer.render(a),this.shotDrawer.render(a),this.playerDrawer.render(a),this.bulletDrawer.render(a),this.topEffectDrawer.render(a),e.flush();var h=passion.GLLayer.padding;t.context.drawImage(i,0,0,n,s,this.width*h,this.height*h,this.width*(1-2*h),this.height*(1-2*h))}},_static:{GL_CANVAS:null,GL:null,padding:.02,quality:1}})}),phina.namespace(function(){phina.define("passion.LaserMazzleFlash",{superClass:"passion.Sprite",init:function(t,e,i){this.superInit(t,e,i)},spawn:function(t){this.superMethod("spawn",t.$safe({frameX:5/8,frameY:1/8,frameW:1/8,frameH:1/8})),this.tweener.to({alpha:0},100).call(function(){this.remove()}.bind(this))}})}),phina.namespace(function(){phina.define("passion.ParticleEmitter",{superClass:"phina.app.Element",x:0,y:0,drawer:null,objName:null,spawnOptions:null,genPerFrame:0,init:function(t,e,i,n){this.superInit(),this.glLayer=t,this.drawer=e,this.objName=i,this.spawnOptions=n},update:function(t){for(var e=0;e<this.genPerFrame;e++){var i=this.drawer.get(this.objName);if(!i)break;i.spawn({}.$extend(this.spawnOptions,{x:this.x,y:this.y})).addChildTo(this.glLayer),this.flare("spawnParticle",{particle:i})}}}),phina.define("passion.Particle",{superClass:"passion.Sprite",init:function(t,e,i){this.superInit(t,e,i),this.on("removed",function(){this.tweener.clear()})}})}),phina.namespace(function(){phina.define("passion.Player",{superClass:"passion.Sprite",_static:{setup:function(t,e){t.playerDrawer.addObjType("player",{className:"passion.Player",texture:"texture0.png"});var i=t.playerDrawer.get("player");i.spawn(e),i.on("enterframe",function(e){if(e.app.ticker.frame%2===0){var n=t.effectDrawer.get("particle"),s=t.effectDrawer.get("particle"),a={x:i.x-8,y:i.y+15,scaleX:18,scaleY:18,frameX:7/8,frameY:0,frameW:1/8,frameH:1/8,red:1,green:1,blue:1,alpha:1},h=function(){this.y+=2,this.alpha*=.8,this.alpha<.01&&this.remove()};n&&(a.x=i.x-8,n.spawn(a),n.onenterframe=h,n.addChildTo(t)),s&&(a.x=i.x+8,s.spawn(a),s.onenterframe=h,s.addChildTo(t))}});var n=t.effectDrawer.get("particle");n.spawn({x:i.x,y:i.y,scaleX:80,scaleY:80,frameX:0,frameY:1/8,frameW:1/8,frameH:1/8,red:2,green:2,blue:2,alpha:.2}),n.addChildTo(t),n.on("enterframe",function(){this.x=i.x,this.y=i.y});var s=t.topEffectDrawer.get("particle");return s.spawn({x:i.x,y:i.y,scaleX:14,scaleY:14,frameX:7/8,frameY:0,frameW:1/8,frameH:1/8,red:.4,green:2,blue:1.6,alpha:1}),s.addChildTo(i),s.on("enterframe",function(){this.x=i.x,this.y=i.y,this.rotation+=.1}),i}},hp:0,_roll:0,heat:0,heatByShot:0,fireable:!0,controllable:!0,mutekiTime:0,init:function(t,e,i){this.superInit(t,e,i),this.on("enterframe",function(t){this.controll(t.app),this.mutekiTime>0&&(this.mutekiTime-=1)})},spawn:function(t){return this.superMethod("spawn",{x:.5*GAME_AREA_WIDTH,y:.9*GAME_AREA_HEIGHT,scaleX:64,scaleY:64,frameX:3/8,frameY:0,frameW:1/8,frameH:1/8,red:1.2,green:1.2,blue:1.2}),this.hp=t.hp,this},controll:function(t){if(this.controllable){var e=t.pointer,i=e.deltaPosition;(phina.isMobile()||e.getPointing())&&(this.x+=2*i.x,this.y+=2*i.y,i.x<0?this.roll-=.2:0<i.x&&(this.roll+=.2),this.x=Math.clamp(this.x,5,GAME_AREA_WIDTH-5),this.y=Math.clamp(this.y,40,GAME_AREA_HEIGHT-5))}if(this.controllable&&0!=i.x||(this.roll*=.9,-.01<this.roll&&this.roll<.01&&(this.roll=0)),this.fireable){var n=!phina.isMobile()&&e.getPointing()||phina.isMobile()&&t.pointers.length>0;n&&this.heat<=0&&(this.flare("fireShot"),this.heat=this.heatByShot)}this.heat-=1},ondamaged:function(t){if(!(this.mutekiTime>0)){t.another}},_accessor:{roll:{get:function(){return this._roll},set:function(t){this._roll=Math.clamp(t,-3,3);var e=~~this._roll;this.frameX=(e+3)/8}}}})}),phina.namespace(function(){var t=function(t,e,i,n,s){var a=this;e.shotDrawer.addObjType("shot",{className:t,texture:a.texture||"bullets.png",additiveBlending:a.additiveBlending||!1,count:a.count||9}),a.hitEffect&&e.topEffectDrawer.addObjType("hitEffect",a.hitEffect),a.mazzleFlashEffect&&e.topEffectDrawer.addObjType("mazzleFlashEffect",a.mazzleFlashEffect);var h=e.shotDrawer.objParameters.shot.pool;i.heatByShot=a.heatByShot,i.on("fireShot",function(t){if(h.length>=a.fireCount){for(var i=0;i<a.fireCount;i++){var r=e.shotDrawer.get("shot");r&&(r.spawn(this,i,s).addChildTo(e),n.push(r))}phina.asset.SoundManager.play("shot")}}),h.forEach(function(t){a.hitEffect&&t.on("hit",function(){var t=e.topEffectDrawer.get("hitEffect");t&&t.spawn({x:this.x,y:this.y}).addChildTo(e)}),t.on("removed",function(){n.erase(this)})}),a.mazzleFlashEffect&&i.on("fireShot",function(t){var i=e.topEffectDrawer.get("mazzleFlashEffect");i&&i.spawn({x:this.x,y:this.y-30}).addChildTo(e)})};phina.define("passion.Shot",{superClass:"passion.Sprite",bx:0,by:0,power:0,age:0,init:function(t,e,i){this.superInit(t,e,i),this.on("enterframe",function(t){this.bx=this.x,this.by=this.y,this.controll(t.app),this.age+=1})},spawn:function(t){return this.superMethod("spawn",t),this.age=0,this},controll:function(t){}}),phina.define("passion.NormalShot",{superClass:"passion.Shot",_static:{setup:t,count:9,heatByShot:8,fireCount:3,additiveBlending:!1,hitEffect:{className:"passion.BulletEraseEffect",texture:"bullets_erase.png",count:9}},init:function(t,e,i){this.superInit(t,e,i),this.power=1},spawn:function(t,e,i){return this.superMethod("spawn",{x:t.x+10*[-1,1,0][e],y:t.y-30+10*[0,0,-1][e],rotation:.5*-Math.PI,scaleX:48,scaleY:48,frameX:1/8,frameY:1/8,frameW:1/8,frameH:1/8,red:1,green:1,blue:1,alpha:.8}),this},controll:function(t){this.y-=20,this.y<GAME_AREA_HEIGHT*-.1&&this.remove()},onhit:function(t){this.remove()}}),phina.define("passion.NormalShot2",{superClass:"passion.Shot",_static:{setup:t,count:18,heatByShot:8,fireCount:5,additiveBlending:!1,hitEffect:{className:"passion.BulletEraseEffect",texture:"bullets_erase.png",count:18}},init:function(t,e,i){this.superInit(t,e,i),this.power=1},spawn:function(t,e,i){return this.superMethod("spawn",{x:t.x+10*[-2,2,-1,1,0][e],y:t.y-30+10*[1,1,0,0,-1][e],rotation:.5*-Math.PI,scaleX:48,scaleY:48,frameX:1/8,frameY:1/8,frameW:1/8,frameH:1/8,red:1,green:1,blue:1,alpha:.8}),this},controll:function(t){this.y-=20,this.y<GAME_AREA_HEIGHT*-.1&&this.remove()},onhit:function(t){this.remove()}}),phina.define("passion.WideShot",{superClass:"passion.Shot",_static:{setup:t,count:9,heatByShot:6,fireCount:3,additiveBlending:!1,hitEffect:{className:"passion.BulletEraseEffect",texture:"bullets_erase.png",count:9}},init:function(t,e,i){this.superInit(t,e,i),this.power=1},spawn:function(t,e,i){return this.superMethod("spawn",{x:t.x+20*[-1,1,0][e],y:t.y,rotation:.5*-Math.PI+.2*[-1,1,0][e],scaleX:48,scaleY:48,frameX:1/8,frameY:1/8,frameW:1/8,frameH:1/8,red:1,green:1,blue:1,alpha:.8}),this.dx=20*Math.cos(this.rotation),this.dy=20*Math.sin(this.rotation),this},controll:function(t){this.x+=this.dx,this.y+=this.dy,(this.y<GAME_AREA_HEIGHT*-.1||this.x<GAME_AREA_WIDTH*-.1||1.1*GAME_AREA_WIDTH<this.x)&&this.remove()},onhit:function(t){this.remove()}}),phina.define("passion.WideShot2",{superClass:"passion.Shot",_static:{setup:t,count:27,heatByShot:6,fireCount:9,additiveBlending:!1,hitEffect:{className:"passion.BulletEraseEffect",texture:"bullets_erase.png",count:27}},init:function(t,e,i){this.superInit(t,e,i),this.power=1},spawn:function(t,e,i){var n=~~(e/3),s=e%3;return this.superMethod("spawn",{x:t.x+30*[-1,1,0][n]+10*[-1,1,0][s],y:t.y,rotation:.5*-Math.PI+.2*[-1,1,0][n],scaleX:48,scaleY:48,frameX:1/8,frameY:1/8,frameW:1/8,frameH:1/8,red:1,green:1,blue:1,alpha:.8}),this.dx=20*Math.cos(this.rotation),this.dy=20*Math.sin(this.rotation),this},controll:function(t){this.x+=this.dx,this.y+=this.dy,(this.y<GAME_AREA_HEIGHT*-.1||this.x<GAME_AREA_WIDTH*-.1||1.1*GAME_AREA_WIDTH<this.x)&&this.remove()},onhit:function(t){this.remove()}}),phina.define("passion.Laser",{superClass:"passion.Shot",_static:{setup:t,count:16,heatByShot:1,fireCount:1,additiveBlending:!0,texture:"effect.png",mazzleFlashEffect:{className:"passion.LaserMazzleFlash",texture:"effect.png",count:16,additiveBlending:!0}},init:function(t,e,i){this.superInit(t,e,i),this.power=1},spawn:function(t,e,i){this.player=t;var n=Math.randint(6,8);return this.superMethod("spawn",{x:t.x,y:t.y-30,rotation:.5*-Math.PI,scaleX:84,scaleY:84,frameX:n%8/8,frameY:~~(n/8)/8,frameW:1/8,frameH:1/8,red:1,green:1,blue:1,alpha:.8}),this},controll:function(t){this.x=this.player.x,this.y-=30,this.scaleX=Math.min(this.scaleY+80,250),this.scaleY=Math.max(this.scaleY-32,16),this.y<GAME_AREA_HEIGHT*-.1&&this.remove()},onhit:function(t){t.enemy.hp>0&&this.remove()}})}),phina.namespace(function(){phina.define("passion.SpritDrawer",{superClass:"phigl.InstancedDrawable",objTypes:null,objParameters:null,init:function(t,e,i,n){this.superInit(t,e),this.objTypes=[],this.objParameters={};var s=phigl.Program(t).attach("sprites.vs").attach("sprites.fs").link();this.setProgram(s).setDrawMode(t.TRIANGLE_STRIP).setIndexValues([0,1,2,3]).setAttributes("position","uv").setAttributeDataArray([{unitSize:2,data:[-.5,.5,.5,.5,-.5,-.5,.5,-.5]},{unitSize:2,data:[0,1,1,1,0,0,1,0]}]).setInstanceAttributes("instanceVisible","instancePosition","instanceRotation","instanceScale","instanceFrame","instanceColor").setUniforms("vpMatrix","texture","globalScale");this.instanceStride/4;this.uniforms.globalScale.setValue(1)},addObjType:function(t,e){if(e={}.$extend({className:"passion.Sprite",count:1,texture:null,additiveBlending:!1},e),!this.objTypes.contains(t)){var i=this.instanceStride/4;this.objTypes.push(t);var n=this.objParameters[t]={count:e.count,instanceVbo:phigl.Vbo(this.gl,this.gl.DYNAMIC_DRAW),texture:phigl.Texture(this.gl,e.texture),pool:null,additiveBlending:e.additiveBlending,instanceData:Array.range(e.count).map(function(t){return[0,0,0,0,0,0,0,0,0,0,0,0,0,0]}).flatten()},s=phina.using(e.className);n.pool=Array.range(e.count).map(function(t){return s(t,n.instanceData,i).on("removed",function(){n.pool.push(this)})})}},get:function(t){return this.objParameters[t].pool.shift()},update:function(){},render:function(t){if(0!==this.objTypes.length){var e=this.gl;this.uniforms.globalScale.value=1,t&&t.forIn(function(t,e){this.uniforms[t]&&(this.uniforms[t].value=e)}.bind(this));var i=this;this.objTypes.forEach(function(t){var n=i.objParameters[t];n.additiveBlending?e.blendFunc(e.SRC_ALPHA,e.ONE):e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),i.setInstanceAttributeVbo(n.instanceVbo.set(n.instanceData)),i.uniforms.texture.setValue(0).setTexture(n.texture),i.draw(n.count)})}}})}),phina.namespace(function(){phina.define("passion.Sprite",{superClass:"phina.app.Element",id:-1,instanceData:null,age:0,_bulletRunning:null,init:function(t,e,i){this.superInit(),this.id=t,this.instanceData=e,this.index=t*i},spawn:function(t){return t.$safe({visible:!0,x:0,y:0,rotation:0,scaleX:1,scaleY:1,frameX:0,frameY:0,frameW:1/8,frameH:1/8,red:1,green:1,blue:1,alpha:1}),this.visible=t.visible,this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.frameX=t.frameX,this.frameY=t.frameY,this.frameW=t.frameW,this.frameH=t.frameH,this.red=t.red,this.green=t.green,this.blue=t.blue,this.alpha=t.alpha,this.age=0,this},update:function(t){this.age+=1},onremoved:function(){this.visible=!1,this.bulletRunning.setRunner(null),this.tweener.clear()},_accessor:{visible:{get:function(){return 1===this.instanceData[this.index+0]},set:function(t){this.instanceData[this.index+0]=t?1:0}},x:{get:function(){return this.instanceData[this.index+1]},set:function(t){this.instanceData[this.index+1]=t}},y:{get:function(){return this.instanceData[this.index+2]},set:function(t){this.instanceData[this.index+2]=t}},rotation:{get:function(){return this.instanceData[this.index+3]},set:function(t){this.instanceData[this.index+3]=t}},scaleX:{get:function(){return this.instanceData[this.index+4]},set:function(t){this.instanceData[this.index+4]=t}},scaleY:{get:function(){return this.instanceData[this.index+5]},set:function(t){this.instanceData[this.index+5]=t}},frameX:{get:function(){return this.instanceData[this.index+6]},set:function(t){this.instanceData[this.index+6]=t}},frameY:{get:function(){return this.instanceData[this.index+7]},set:function(t){this.instanceData[this.index+7]=t}},frameW:{get:function(){return this.instanceData[this.index+8]},set:function(t){this.instanceData[this.index+8]=t}},frameH:{get:function(){return this.instanceData[this.index+9]},set:function(t){this.instanceData[this.index+9]=t}},red:{get:function(){return this.instanceData[this.index+10]},set:function(t){this.instanceData[this.index+10]=t}},green:{get:function(){return this.instanceData[this.index+11]},set:function(t){this.instanceData[this.index+11]=t}},blue:{get:function(){return this.instanceData[this.index+12]},set:function(t){this.instanceData[this.index+12]=t}},alpha:{get:function(){return this.instanceData[this.index+13]},set:function(t){this.instanceData[this.index+13]=t}}}}),passion.Sprite.prototype.getter("bulletRunning",function(){return this._bulletRunning||(this._bulletRunning=passion.BulletRunning().attachTo(this)),this._bulletRunning})}),phina.namespace(function(){phina.define("passion.UIFrame",{superClass:"phina.display.Shape",init:function(t){this.superInit(t),this.backgroundColor="transparent",this.strokeWidth=2},prerender:function(t){var e=t.context;e.beginPath(),e.moveTo(-this.width/2+10,-this.height/2),e.lineTo(this.width/2-5,-this.height/2),e.lineTo(this.width/2,-this.height/2+5),e.lineTo(this.width/2,this.height/2-10),e.lineTo(this.width/2-10,this.height/2),e.lineTo(-this.width/2+35,this.height/2),e.lineTo(-this.width/2+30,this.height/2-5),e.lineTo(-this.width/2,this.height/2-5),e.lineTo(-this.width/2,10-this.height/2),e.closePath();var i=e.createLinearGradient(this.height/2,-this.width/2,-this.height/2,this.width/2);i.addColorStop(0,"hsla(190, 100%, 30%, 0.8)"),i.addColorStop(.38,"hsla(190, 100%, 30%, 0.8)"),i.addColorStop(.48,"hsla(190, 100%, 80%, 0.8)"),i.addColorStop(.52,"hsla(190, 100%, 80%, 0.8)"),i.addColorStop(.62,"hsla(190, 100%, 30%, 0.8)"),i.addColorStop(1,"hsla(190, 100%, 30%, 0.8)"),this.stroke=i;var n=e.createLinearGradient(this.height/2,-this.width/2,-this.height/2,this.width/2);n.addColorStop(0,"hsla(210, 100%, 30%, 0.2)"),n.addColorStop(.38,"hsla(210, 100%, 30%, 0.2)"),n.addColorStop(.48,"hsla(210, 100%, 80%, 0.2)"),n.addColorStop(.52,"hsla(210, 100%, 80%, 0.2)"),n.addColorStop(.62,"hsla(210, 100%, 30%, 0.2)"),n.addColorStop(1,"hsla(210, 100%, 30%, 0.2)"),this.fill=n},postrender:function(t){var e=t.context;e.beginPath(),e.moveTo(-this.width/2+10-3,-this.height/2-3),e.lineTo(this.width/2-5+3,-this.height/2-3),e.lineTo(this.width/2+3,-this.height/2+5-3),e.lineTo(this.width/2+3,this.height/2-10+3),e.lineTo(this.width/2-10+3,this.height/2+3),e.lineTo(-this.width/2+35-3,this.height/2+3),e.lineTo(-this.width/2+30-3,this.height/2-5+3),e.lineTo(-this.width/2-3,this.height/2-5+3),e.lineTo(-this.width/2-3,-this.height/2+10-3),e.closePath(),e.lineWidth=1,e.stroke()}})}),phina.namespace(function(){phina.define("passion.UIHeadLabel",{superClass:"phina.display.Shape",init:function(t){this.superInit(t),this.backgroundColor="transparent",this.stroke="hsla(190, 100%, 60%, 1.0)",this.strokeWidth=1,this.fromJSON({children:{text:{className:"phina.display.Label",arguments:{text:t.text,fontSize:t.fontSize||24,fontFamily:t.fontFamily||"main",align:t.align||"center"},fill:"hsla(190, 100%, 95%, 0.8)",strokeWidth:0}}})},prerender:function(t){var e=t.context,i=e.createLinearGradient(0,-this.height/2,0,this.height/2);i.addColorStop(0,"hsla(190, 100%, 50%, 0.2)"),i.addColorStop(.4,"hsla(190, 100%, 30%, 0.2)"),i.addColorStop(.6,"hsla(190, 100%, 30%, 0.2)"),i.addColorStop(1,"hsla(190, 100%, 50%, 0.2)"),this.fill=i},postrender:function(t){var e=t.context;e.beginPath(),e.moveTo(-this.width/2,this.height/2),e.lineTo(-this.width/2,-this.height/2+10),e.lineTo(-this.width/2+10,-this.height/2),e.lineTo(this.width/2,-this.height/2),e.lineTo(this.width/2,this.height/2-10),e.lineTo(this.width/2-10,this.height/2),e.closePath(),e.fill(),e.beginPath(),e.moveTo(-this.width/2,this.height/2),e.lineTo(-this.width/2,-this.height/2+10),
e.lineTo(-this.width/2+10,-this.height/2),e.stroke(),e.beginPath(),e.moveTo(this.width/2,-this.height/2),e.lineTo(this.width/2,this.height/2-10),e.lineTo(this.width/2-10,this.height/2),e.stroke()}})}),phina.namespace(function(){phina.define("passion.UIHead2Label",{superClass:"phina.display.Shape",init:function(t){this.superInit(t),this.backgroundColor="transparent",this.strokeWidth=1,this.fromJSON({children:{text:{className:"phina.display.Label",arguments:{text:t.text,fontSize:t.fontSize||24,fontFamily:t.fontFamily||"main",align:t.align||"center"},fill:"hsla(190, 100%, 95%, 0.8)",strokeWidth:0}}})},prerender:function(t){var e=t.context,i=e.createLinearGradient(0,-this.height/2,0,this.height/2);i.addColorStop(0,"hsla(190, 100%, 50%, 0.2)"),i.addColorStop(.4,"hsla(190, 100%, 30%, 0.2)"),i.addColorStop(.6,"hsla(190, 100%, 30%, 0.2)"),i.addColorStop(1,"hsla(190, 100%, 50%, 0.2)"),this.fill=i;var n=e.createLinearGradient(-this.width/2,0,this.width/2,0);n.addColorStop(0,"hsla(190, 100%, 60%, 0.0)"),n.addColorStop(.3,"hsla(190, 100%, 60%, 1.0)"),n.addColorStop(.7,"hsla(190, 100%, 60%, 1.0)"),n.addColorStop(1,"hsla(190, 100%, 60%, 0.0)"),this.stroke=n},postrender:function(t){var e=t.context;e.beginPath(),e.moveTo(-this.width/2,this.height/2),e.lineTo(-this.width/2,-this.height/2),e.lineTo(this.width/2,-this.height/2),e.lineTo(this.width/2,this.height/2),e.closePath(),e.fill(),e.beginPath(),e.moveTo(-this.width/2,this.height/2),e.lineTo(this.width/2,this.height/2),e.stroke(),e.beginPath(),e.moveTo(-this.width/2,-this.height/2),e.lineTo(this.width/2,-this.height/2),e.stroke()}})}),phina.namespace(function(){phina.define("passion.UILayer",{superClass:"phina.display.DisplayElement",init:function(t){this.superInit(),this.fromJSON({originX:0,originY:0,children:{damage:{className:"phina.display.Sprite",arguments:this.damageTexture(),originX:0,originY:0,alpha:0,x:GAME_AREA_WIDTH*passion.GLLayer.padding,y:GAME_AREA_HEIGHT*passion.GLLayer.padding},scoreBg:{className:"passion.UIFrame",arguments:{width:.96*SCREEN_WIDTH,height:.05*SCREEN_HEIGHT},x:0*SCREEN_WIDTH,y:0*SCREEN_HEIGHT,originX:0,originY:0,children:{scoreLabel:{className:"phina.display.Label",arguments:{text:"9,991,234,567,890",align:"right",baseline:"middle",fontSize:.035*SCREEN_HEIGHT},x:.96*SCREEN_WIDTH,y:.038*SCREEN_HEIGHT},hi:{className:"phina.display.Label",arguments:{text:"HI",align:"left",baseline:"middle",fontSize:.025*SCREEN_HEIGHT},x:.04*SCREEN_WIDTH,y:.035*SCREEN_HEIGHT},highscoreLabel:{className:"phina.display.Label",arguments:{text:"9,991,234,567,890",align:"right",baseline:"middle",fontSize:.025*SCREEN_HEIGHT},x:.44*SCREEN_WIDTH,y:.035*SCREEN_HEIGHT}}},messageWindow:{className:"passion.UIFrame",arguments:{width:.96*SCREEN_WIDTH,height:.14*SCREEN_HEIGHT},x:0*SCREEN_WIDTH,y:.84*SCREEN_HEIGHT,originX:0,originY:0,children:{nameLabel:{className:"passion.UIHead2Label",arguments:{text:"オペ子",width:.3*SCREEN_WIDTH,height:.03*SCREEN_HEIGHT,fontSize:18,fontFamily:"main, message"},x:.2*SCREEN_WIDTH,y:.034*SCREEN_HEIGHT,visible:!1},mesasgeLabel:{className:"phina.display.Label",arguments:{text:"WARNING!!\n今までにない強大な力が近づいてきます！\n気をつけてください！！",align:"left",baseline:"top",fontSize:16,lineHeight:1.1,fontFamily:"main, message"},x:.05*SCREEN_WIDTH,y:.076*SCREEN_HEIGHT,visible:!1}}},bombButton:{className:"passion.CircleButton",arguments:{text:"HYPER",fontSize:15,radius:.09*GAME_AREA_WIDTH},x:.12*GAME_AREA_WIDTH,y:.92*GAME_AREA_HEIGHT},readyLabels:{className:"phina.display.DisplayElement",x:.5*GAME_AREA_WIDTH,y:.5*GAME_AREA_HEIGHT,children:"Ready".split("").map(function(t,e){return{className:"phina.display.Label",arguments:{text:t,align:"center",baseline:"middle",fontSize:60},x:60*("Ready".length*-.5+e+.5)*.56}}),visible:!1},goLabel:{className:"phina.display.Label",arguments:{text:"GO!!",align:"center",baseline:"middle",fontSize:60},x:.5*GAME_AREA_WIDTH,y:.5*GAME_AREA_HEIGHT,visible:!1}}});var e=this;t.on("updateScore",function(){e.scoreBg.scoreLabel.text=passion.Utils.sep(this.score),this.highScore<this.score&&(e.scoreBg.highscoreLabel.text=passion.Utils.sep(this.highScore))}),t.on("damaged",function(t){})},showReadyGo:function(t){this.readyLabels.visible=!0,this.goLabel.visible=!0,this.readyLabels.children.forEach(function(t,e){t.tweener.set({scaleX:4,scaleY:4,alpha:0}).wait(200*e).to({scaleX:1,scaleY:1,alpha:1},200).wait(500+200*("Ready".length-e)).to({scaleX:0,scaleY:0,alpha:0},100)}),this.goLabel.tweener.set({scaleX:0,scaleY:0,alpha:0}).wait(900+200*"Ready".length).to({scaleX:1,scaleY:1,alpha:1},200).wait(500).to({scaleX:5,scaleY:5,alpha:0},200).call(function(){this.readyLabels.visible=!1,this.goLabel.visible=!1,t()}.bind(this))},damageTexture:function(){var t=phina.graphics.Canvas(),e=passion.GLLayer.padding;t.setSize(GAME_AREA_WIDTH*(1-2*e),GAME_AREA_HEIGHT*(1-2*e)),t.clearColor("transparent");var i=t.context.createRadialGradient(t.width/2,t.height/2,0,t.width/2,t.height/2,t.height/2);return i.addColorStop(0,"rgba(255, 0, 0, 0.0)"),i.addColorStop(1,"rgba(255, 0, 0, 1.0)"),t.fillStyle=i,t.fillRect(0,0,t.width,t.height),t}})}),phina.namespace(function(){phina.define("passion.BulletRunning",{superClass:"phina.accessory.Accessory",runner:null,init:function(){this.superInit()},setRunner:function(t){return this.runner=t,this},onattached:function(){this.runner&&(this.target.x=this.runner.x,this.target.y=this.runner.y,this.target.rotation=this.runner.direction,this.runner.onVanish=function(){this.remove()}.bind(this.target))},update:function(t){this.runner&&(this.runner.update(),this.target.x=this.runner.x,this.target.y=this.runner.y,this.target.rotation=this.runner.direction)}})}),phina.namespace(function(){phina.define("passion.GamepadManager",{superClass:"phina.input.GamepadManager",init:function(){this.superInit()},get:function(t){return t=t||0,this.gamepads[t]||(this._created.push(t),this.gamepads[t]=passion.Gamepad(t)),this.gamepads[t]}}),phina.define("passion.Gamepad",{superClass:"phina.input.Gamepad",beforeStickX:0,beforeStickY:0,_leftCount:0,_rightCount:0,_upCount:0,_downCount:0,init:function(t){this.superInit(t)},_updateState:function(t){this.superMethod("_updateState",t),this._updateEvery()},_updateStateEmpty:function(){this.superMethod("_updateStateEmpty"),this._updateEvery()},_updateEvery:function(){var t=this.getStickDirection();this.getKeyUp("left")||this.beforeStickX<-.5&&-.5<=t.x?this._leftCount=0:(this.getKey("left")||t.x<-.5)&&(this._leftCount+=1),this.getKeyUp("right")||.5<this.beforeStickX&&t.x<=.5?this._rightCount=0:(this.getKey("right")||.5<t.x)&&(this._rightCount+=1),this.getKeyUp("up")||this.beforeStickY<-.5&&-.5<=t.y?this._upCount=0:(this.getKey("up")||t.y<-.5)&&(this._upCount+=1),this.getKeyUp("down")||.5<this.beforeStickY&&t.y<=.5?this._downCount=0:(this.getKey("down")||.5<t.y)&&(this._downCount+=1),this.beforeStickX=t.x,this.beforeStickY=t.y},_accessor:{leftPressing:{get:function(){var t=this._leftCount,e=this.getKey("left")||this.getStickDirection().x<-.5;return e&&(1==t||40<t&&t%6==0)}},rightPressing:{get:function(){var t=this._rightCount,e=this.getKey("right")||.5<this.getStickDirection().x;return e&&(1==t||40<t&&t%6==0)}},upPressing:{get:function(){var t=this._upCount,e=this.getKey("up")||this.getStickDirection().y<-.5;return e&&(1==t||40<t&&t%6==0)}},downPressing:{get:function(){var t=this._downCount,e=this.getKey("down")||.5<this.getStickDirection().y;return e&&(1==t||40<t&&t%6==0)}}}})}),phina.namespace(function(){phina.define("passion.GameSceneBg",{_static:{drawBgTexture:function(){var t=phina.graphics.Canvas();return t.setSize(SCREEN_WIDTH,SCREEN_HEIGHT),t.clearColor("hsla(190, 100%, 95%, 0.05)"),150..times(function(e,i){var n=1.5*SCREEN_HEIGHT/i*e;t.strokeStyle="hsla(190, 100%, 95%, 0.1)",t.strokeLines(0*SCREEN_WIDTH,n-10,.1*SCREEN_WIDTH,n-10,.2*SCREEN_WIDTH,n+20,.5*SCREEN_WIDTH,n+20,.6*SCREEN_WIDTH,n-30,.7*SCREEN_WIDTH,n-30,.8*SCREEN_WIDTH,n-50,1*SCREEN_WIDTH,n-50),t.strokeStyle="hsla(190, 100%, 65%, 0.1)",n+=1,t.strokeLines(0*SCREEN_WIDTH,n-10,.1*SCREEN_WIDTH,n-10,.2*SCREEN_WIDTH,n+20,.5*SCREEN_WIDTH,n+20,.6*SCREEN_WIDTH,n-30,.7*SCREEN_WIDTH,n-30,.8*SCREEN_WIDTH,n-50,1*SCREEN_WIDTH,n-50),t.strokeStyle="hsla(190, 100%, 35%, 0.1)",n+=1,t.strokeLines(0*SCREEN_WIDTH,n-10,.1*SCREEN_WIDTH,n-10,.2*SCREEN_WIDTH,n+20,.5*SCREEN_WIDTH,n+20,.6*SCREEN_WIDTH,n-30,.7*SCREEN_WIDTH,n-30,.8*SCREEN_WIDTH,n-50,1*SCREEN_WIDTH,n-50)}),t}},init:function(){}})}),phina.namespace(function(){phina.define("passion.Keyboard",{superClass:"phina.input.Keyboard",_leftCount:0,_rightCount:0,_upCount:0,_downCount:0,init:function(t){this.superInit(t)},update:function(){this.superMethod("update"),this.getKeyUp("left")?this._leftCount=0:this.getKey("left")&&(this._leftCount+=1),this.getKeyUp("right")?this._rightCount=0:this.getKey("right")&&(this._rightCount+=1),this.getKeyUp("up")?this._upCount=0:this.getKey("up")&&(this._upCount+=1),this.getKeyUp("down")?this._downCount=0:this.getKey("down")&&(this._downCount+=1)},_accessor:{leftPressing:{get:function(){var t=this._leftCount,e=this.getKey("left");return e&&(1==t||40<t&&t%6==0)}},rightPressing:{get:function(){var t=this._rightCount,e=this.getKey("right");return e&&(1==t||40<t&&t%6==0)}},upPressing:{get:function(){var t=this._upCount,e=this.getKey("up");return e&&(1==t||40<t&&t%6==0)}},downPressing:{get:function(){var t=this._downCount,e=this.getKey("down");return e&&(1==t||40<t&&t%6==0)}}},_static:phina.input.Keyboard._static})}),phina.namespace(function(){phina.define("passion.GameManager",{superClass:"phina.util.EventDispatcher",score:0,highScore:0,frame:0,waitTo:0,timeline:null,init:function(t,e){this.superInit(),this.timeline=t.timeline,this.waitTo=-1},update:function(t){for(;(this.waitTo===this.frame||this.waitTo===-1)&&this.timeline.length>0;){this.waitTo=-1;var e=this.timeline.shift();this[e.type](e.arguments)}this.frame+=1},startBgm:function(t){},stopBgm:function(){},wait:function(t){this.waitTo=this.frame+t.time},enemy:function(t){this.flare("spawnEnemy",t)},enemyGroup:function(t){var e;e="string"==typeof t.enemy?{name:e}:t.enemy;for(var i=0;i<t.count;i++)this.flare("spawnEnemy",{}.$extend(e,{x:(t.x||0)+(t.dx||0)*i,y:(t.y||0)+(t.dy||0)*i,wait:(t.wait||0)+(t.dwait||0)*i}))},warning:function(t){},boss:function(t){}})}),phina.namespace(function(){phina.define("passion.Pool",{array:null,dirty:null,comparator:null,init:function(t,e){this.array=t||[],this.comparator=e||function(t,e){return t-e},this.dirty=!0},add:function(t){this.array.push(t),this.dirty=!0},get:function(){return this.dirty&&(this.array.sort(this.comparator),this.dirty=!1),this.array.shift()}}),Array.prototype.$method("toPool",function(t){return passion.Pool(this,t)})}),phina.namespace(function(){phina.define("passion.GameScene",{superClass:"phina.display.DisplayScene",gameManager:null,status:-1,shots:null,enemies:null,bullets:null,items:null,init:function(t){this.superInit(t);var e=this,i=phina.asset.AssetManager.get("json","stage").data,n=phina.util.Random(12345),s=function(){return n.random()};bulletml.Walker.random=s,this.gameManager=passion.GameManager(i,s),this.fromJSON({shots:[],enemies:[],bullets:[],items:[],children:{bg:{className:"phina.display.Sprite",arguments:passion.GameSceneBg.drawBgTexture(),originX:0,originY:0},glLayer:{className:"passion.GLLayer"},uiLayer:{className:"passion.UILayer",arguments:this.gameManager,alpha:0}}}),this.uiLayer.tweener.clear().fadeIn(500);var a=this.gameManager,h=this.glLayer;h.effectDrawer.addObjType("particle",{texture:"texture0.png",additiveBlending:!0,count:200}),h.topEffectDrawer.addObjType("BulletEraseEffect",{className:"passion.BulletEraseEffect",texture:"bullets_erase.png",count:200}),h.topEffectDrawer.addObjType("particle",{className:"passion.Particle",texture:"texture0.png",count:200,additiveBlending:!0}),passion.Background.setup(h,"bg",1069);var r={hp:100};this.player=passion.Player.setup(h,r).addChildTo(h);var o="passion.Laser",l=phina.using(o);l.setup(o,h,this.player,this.shots,e),i.enemies.map(function(t){return phina.asset.AssetManager.get("json",t+".enemy").data}).map(function(t){return t.texture}).uniq().forEach(function(t){h.enemyDrawer.addObjType(t,{className:"passion.Enemy",texture:t,count:50}),h.enemyDrawer.objParameters[t].pool.forEach(function(t){t.on("removed",function(){u.erase(this)}),t.on("killed",function(){this.playKilledEffect(e)})})});var u=this.enemies;a.on("spawnEnemy",function(t){var e=phina.asset.AssetManager.get("json",t.name+".enemy").data,i=h.enemyDrawer.get(e.texture);i&&(i.spawn({}.$extend(e,t,{x:t.x*GAME_AREA_WIDTH,y:t.y*GAME_AREA_HEIGHT})),i.addChildTo(h),u.push(i))}),passion.Danmaku.setup(this);var c=this.bullets;this.on("spawnBullet",function(t){var e=t.bullet;e.addChildTo(h),c.push(e)}),h.bulletDrawer.pool.array.forEach(function(t){t.on("removed",function(){c.erase(this)}),t.on("erased",function(){var t=h.topEffectDrawer.get("BulletEraseEffect");t&&t.spawn({x:this.x,y:this.y,frameY:0}).addChildTo(h)})}),this.uiLayer.showReadyGo(function(){e.status=0})},update:function(t){switch(this.status){case 0:this.gameManager.update(t),this._hitTest()}var e=t.keyboardEx,i=t.gamepadManager.get();(i.leftPressing||e.leftPressing)&&console.log("left"+Date.now()),(i.rightPressing||e.rightPressing)&&console.log("right"+Date.now()),(i.upPressing||e.upPressing)&&console.log("up"+Date.now()),(i.downPressing||e.downPressing)&&console.log("down"+Date.now())},_hitTest:function(){this._hitTestItemPlayer(),this._hitTestEnemyShot(),this._hitTestEnemyPlayer(),this._hitTestBulletPlayer()},_hitTestItemPlayer:function(){},_hitTestEnemyShot:function(){for(var t=this.enemies.clone(),e=this.shots.clone(),i=0;i<t.length;i++)for(var n=t[i],s=0;s<e.length;s++){var a=e[s];n.isHit(a)&&(n.flare("damaged",{shot:a}),a.flare("hit",{enemy:n}))}},_hitTestEnemyPlayer:function(){for(var t=this.enemies.clone(),e=this.player,i=0;i<t.length;i++){var n=t[i];n.isHit(e)&&e.flare("damaged",{another:n})}},_hitTestBulletPlayer:function(){for(var t=this.bullets.clone(),e=this.player,i=0;i<t.length;i++){var n=t[i];n.isHit(e)&&e.flare("damaged",{another:n})}},eraseAllBullets:function(){this.bullets.clone().forEach(function(t){t.flare("erased"),t.remove()})},onspawnItem:function(t){var e=t.item;e.addChildTo(this.glLayer),this.items.push(e)},onspawnParticle:function(t){var e=phina.using(t.className),i=e(this.glLayer,this.glLayer.topEffectDrawer);i.x=t.x,i.y=t.y,i.addChildTo(this.glLayer)}})}),phina.namespace(function(){phina.define("passion.StageAssetLoadScene",{superClass:"phina.display.DisplayScene",init:function(t){this.superInit(t),this.fromJSON({children:{bg0:{className:"phina.display.Sprite",arguments:passion.GameSceneBg.drawBgTexture(),originX:0,originY:0},bg1:{className:"passion.UIFrame",arguments:{fill:"black",stroke:null,width:.9*SCREEN_WIDTH,height:.1*SCREEN_HEIGHT},x:.5*SCREEN_WIDTH,y:.5*SCREEN_HEIGHT},label:{className:"phina.display.Label",arguments:{text:""},x:.5*SCREEN_WIDTH,y:.5*SCREEN_HEIGHT,alpha:0}}}),this.step0(t.stage)},update:function(t){var e=Math.floor(.1*t.ticker.frame)%4,i="downloading";e.times(function(){i+="."}),i.paddingRight("downloading".length+3," "),this.label.text=i},step0:function(t){var e=phina.asset.AssetLoader();e.load({json:{stage:"./asset/stage/"+t+".json"}}),this.label.tweener.fadeIn(1e3),e.on("load",function(){this.step1()}.bind(this))},step1:function(){var t=phina.asset.AssetManager.get("json","stage").data,e={};t.enemies.forEach(function(t){e[t+".enemy"]="./asset/enemy/"+t+".json"});var i={};t.bgm.forEach(function(t,e){i["bgm"+e]="./asset/sound/"+t.bgm+".mp3"});var n=phina.asset.AssetLoader();n.load({json:e,sound:i,image:{bg:"./asset/image/"+t.bg+".png"}}),n.on("load",function(){this.step2(t)}.bind(this))},step2:function(t){var e={};t.enemies.map(function(t){return phina.asset.AssetManager.get("json",t+".enemy").data}).map(function(t){return t.texture}).uniq().forEach(function(t){e[t]="./asset/image/"+t+".png"});var i=phina.asset.AssetLoader();i.load({image:e}),i.on("load",function(){this.step3(t)}.bind(this))},step3:function(t){var e={};t.enemies.map(function(t){return phina.asset.AssetManager.get("json",t+".enemy").data}).forEach(function(t){t.motion&&(e["motion/"+t.motion]="./asset/motion/"+t.motion+".xml"),t.attack&&(e["attack/"+t.attack]="./asset/attack/"+t.attack+".xml")}),t.timeline.forEach(function(t){t.arguments.motion&&(e["motion/"+t.arguments.motion]="./asset/motion/"+t.arguments.motion+".xml"),t.arguments.attack&&(e["attack/"+t.arguments.attack]="./asset/attack/"+t.arguments.attack+".xml"),t.arguments.enemy&&(t.arguments.enemy.motion&&(e["motion/"+t.arguments.enemy.motion]="./asset/motion/"+t.arguments.enemy.motion+".xml"),t.arguments.enemy.attack&&(e["attack/"+t.arguments.enemy.attack]="./asset/attack/"+t.arguments.enemy.attack+".xml"))});var i=phina.asset.AssetLoader();i.load({xml:e}),i.on("load",function(){this.step4()}.bind(this))},step4:function(){this.label.tweener.clear().fadeOut(100),this.bg1.tweener.fadeOut(500).call(function(){this.app.popScene()}.bind(this))}})}),phina.namespace(function(){phina.define("passion.Utils",{_static:{sep:function(t){return(""+Math.floor(t)).replace(/(\d)(?=(\d{3})+$)/g,"$1,")}},init:function(){}}),phina.accessory.Tweener.$method("clone",function(){return phina.accessory.Tweener(this.target)})});