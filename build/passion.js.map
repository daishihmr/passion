{"version":3,"sources":["main.js","Application.js","Assets.js","Camera.js","Background.js","Bullet.js","BulletDrawer.js","CircleButton.js","GLLayer.js","Player.js","SpritDrawer.js","Sprite.js","UIFrame.js","UILayer.js","Pool.js","GameScene.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"passion.js","sourcesContent":["var SCREEN_WIDTH = 360;\r\nvar SCREEN_HEIGHT = 640;\r\nvar GAME_AREA_WIDTH = SCREEN_WIDTH;\r\nvar GAME_AREA_HEIGHT = SCREEN_HEIGHT * 0.85;\r\nvar FPS = 60;\r\n\r\nphina.main(function() {\r\n\r\n  phina.display.DisplayScene.defaults.$extend({\r\n    width: SCREEN_WIDTH,\r\n    height: SCREEN_HEIGHT,\r\n    backgroundColor: \"transparent\",\r\n  });\r\n  \r\n  phina.display.Label.defaults.fontFamily = \"main\";\r\n  phina.display.Label.defaults.fill = \"white\";\r\n\r\n  var app = passion.Application();\r\n  app.enableStats();\r\n  app.run();\r\n\r\n  app.replaceScene(phina.game.ManagerScene({\r\n    scenes: [\r\n\r\n      {\r\n        className: \"phina.game.LoadingScene\",\r\n        arguments: {\r\n          assets: passion.Assets.get({ assetType: \"common\" }),\r\n        },\r\n      },\r\n\r\n      {\r\n        className: \"passion.GameScene\",\r\n      },\r\n\r\n    ]\r\n  }));\r\n\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"passion.Application\", {\r\n    superClass: \"phina.display.CanvasApp\",\r\n\r\n    init: function() {\r\n      this.superInit({\r\n        width: SCREEN_WIDTH,\r\n        height: SCREEN_HEIGHT,\r\n        backgroundColor: \"#114\",\r\n      });\r\n\r\n      this.fps = FPS;\r\n    },\r\n\r\n  });\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"passion.Assets\", {\r\n    _static: {\r\n      get: function(options) {\r\n        switch (options.assetType) {\r\n          case \"common\":\r\n            return {\r\n              font: {\r\n                main: \"./asset/font/Baumans/Baumans-Regular.ttf\",\r\n              },\r\n              image: {\r\n                \"test.png\": \"./asset/image/test.png\",\r\n                \"bullets.png\": \"./asset/image/bullets.png\",\r\n                \"texture0.png\": \"./asset/image/texture0.png\",\r\n              },\r\n              vertexShader: {\r\n                \"bullets.vs\": \"./asset/shader/bullets.vs\",\r\n                \"sprites.vs\": \"./asset/shader/sprites.vs\",\r\n              },\r\n              fragmentShader: {\r\n                \"bullets.fs\": \"./asset/shader/bullets.fs\",\r\n                \"sprites.fs\": \"./asset/shader/sprites.fs\",\r\n              },\r\n            };\r\n          default:\r\n            throw \"invalid assetType: \" + options.assetType;\r\n        }\r\n      },\r\n    },\r\n  });\r\n\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"passion.Camera\", {\r\n\r\n    position: null,\r\n    vMatrix: null,\r\n    pMatrix: null,\r\n    vpMatrix: null,\r\n\r\n    init: function() {\r\n      this.position = vec3.create();\r\n      this.vMatrix = mat4.create();\r\n      this.pMatrix = mat4.create();\r\n      this.vpMatrix = mat4.create();\r\n    },\r\n\r\n    setPosition: function(x, y, z) {\r\n      vec3.set(this.position, x, y, z);\r\n      return this;\r\n    },\r\n\r\n    lookAt: function(x, y, z) {\r\n      mat4.lookAt(this.vMatrix, this.position, [x, y, z], [0, 1, 0]);\r\n      return this;\r\n    },\r\n\r\n    ortho: function(left, right, bottom, top, near, far) {\r\n      mat4.ortho(this.pMatrix, left, right, bottom, top, near, far);\r\n      return this;\r\n    },\r\n\r\n    perspective: function(fovy, aspect, near, far) {\r\n      mat4.perspective(this.pMatrix, fovy, aspect, near, far);\r\n      return this;\r\n    },\r\n\r\n    calcVpMatrix: function() {\r\n      mat4.mul(this.vpMatrix, this.pMatrix, this.vMatrix);\r\n      return this;\r\n    },\r\n\r\n    uniformValues: function() {\r\n      return {\r\n        vpMatrix: this.vpMatrix,\r\n        cameraPosition: this.position,\r\n      };\r\n    }\r\n\r\n  });\r\n});\r\n","phina.namespace(function() {\r\n  \r\n  phina.define(\"passion.Background\", {\r\n    superClass: \"passion.Sprite\",\r\n    \r\n    init: function(id, instanceData, instanceStride) {\r\n      this.superInit(id, instanceData, instanceStride);\r\n      this.on(\"enterframe\", function() {\r\n        this.y += 3;\r\n        if (this.y > GAME_AREA_HEIGHT / 2 + 640) {\r\n          this.y -= 640 * 2;\r\n        }\r\n      });\r\n    },\r\n\r\n    spawn: function() {\r\n      passion.Sprite.prototype.spawn.call(this, {\r\n        scaleX: 360,\r\n        scaleY: 640,\r\n        frameX: 0,\r\n        frameY: 0,\r\n        frameW: 1,\r\n        frameH: 1,\r\n        red: 0.5,\r\n        green: 0.5,\r\n        blue: 0.5,\r\n      });\r\n      return this;\r\n    },\r\n\r\n  });\r\n});","phina.namespace(function() {\r\n\r\n  phina.define(\"passion.Bullet\", {\r\n    superClass: \"phina.app.Element\",\r\n\r\n    id: -1,\r\n    instanceData: null,\r\n    runner: null,\r\n\r\n    x: 0,\r\n    y: 0,\r\n    age: 0,\r\n\r\n    power: 0,\r\n\r\n    _active: false,\r\n    \r\n    radius: 20,\r\n\r\n    init: function(id, instanceData, instanceStride) {\r\n      this.superInit();\r\n      this.id = id;\r\n      this.instanceData = instanceData;\r\n\r\n      this.index = id * instanceStride;\r\n    },\r\n\r\n    spawn: function(runner, option) {\r\n      var instanceData = this.instanceData;\r\n      var index = this.index;\r\n\r\n      this.runner = runner;\r\n      this.x = runner.x;\r\n      this.y = runner.y;\r\n      this.age = 0;\r\n      instanceData[index + 0] = this.x;\r\n      instanceData[index + 1] = this.y;\r\n      instanceData[index + 2] = runner.direction; // rotation\r\n      instanceData[index + 3] = option.scale; // scale\r\n      instanceData[index + 4] = option.type % 8; // frame.x\r\n      instanceData[index + 5] = ~~(option.type / 8); // frame.y\r\n      instanceData[index + 6] = 1; // visible\r\n      instanceData[index + 7] = 1; // brightness\r\n      instanceData[index + 8] = 0.2 + ~~(option.type / 8) % 2; // auraColor.r\r\n      instanceData[index + 9] = 0.2 + 0; // auraColor.g\r\n      instanceData[index + 10] = 0.2 + ~~(option.type / 8) % 2 + 1; // auraColor.b\r\n\r\n      var self = this;\r\n      runner.onVanish = function() {\r\n        self.remove();\r\n      };\r\n\r\n      return this;\r\n    },\r\n\r\n    activate: function() {\r\n      this._active = true;\r\n      this.flare(\"activated\");\r\n      return this;\r\n    },\r\n\r\n    inactivate: function() {\r\n      this._active = false;\r\n      this.flare(\"inactivated\");\r\n      return this;\r\n    },\r\n\r\n    onremoved: function() {\r\n      this.instanceData[this.index + 6] = 0;\r\n    },\r\n\r\n    update: function(app) {\r\n      var instanceData = this.instanceData;\r\n      var index = this.index;\r\n      var runner = this.runner;\r\n\r\n      runner.update();\r\n      this.x = runner.x;\r\n      this.y = runner.y;\r\n\r\n      if (this.x < -50 || GAME_AREA_WIDTH + 50 < this.x || this.y < -50 || GAME_AREA_HEIGHT + 50 < this.y) {\r\n        this.remove();\r\n        return;\r\n      }\r\n\r\n      instanceData[index + 0] = this.x;\r\n      instanceData[index + 1] = this.y;\r\n      instanceData[index + 7] = 1.5 + Math.sin(this.age * 0.2) * 0.6;\r\n\r\n      this.age += 1;\r\n    },\r\n\r\n    hitPlayer: function(player) {\r\n      // TODO\r\n      this.remove();\r\n    },\r\n  });\r\n\r\n});\r\n","phina.namespace(function() {\r\n  phina.define(\"passion.BulletDrawer\", {\r\n    superClass: \"phigl.InstancedDrawable\",\r\n\r\n    instanceData: null,\r\n\r\n    pool: null,\r\n    _count: 500,\r\n\r\n    init: function(gl, ext, w, h) {\r\n      this.superInit(gl, ext);\r\n\r\n      var shader = phigl.Program(gl)\r\n        .attach(\"bullets.vs\")\r\n        .attach(\"bullets.fs\")\r\n        .link();\r\n\r\n      this\r\n        .setProgram(shader)\r\n        .setDrawMode(gl.TRIANGLE_STRIP)\r\n        .setIndexValues([0, 1, 2, 3])\r\n        .setAttributes(\"position\", \"uv\")\r\n        .setAttributeDataArray([{\r\n          unitSize: 2,\r\n          data: [\r\n            //\r\n            -0.5, +0.5,\r\n            //\r\n            +0.5, +0.5,\r\n            //\r\n            -0.5, -0.5,\r\n            //\r\n            +0.5, -0.5,\r\n          ]\r\n        }, {\r\n          unitSize: 2,\r\n          data: [\r\n            //\r\n            0, 32 / 256,\r\n            //\r\n            32 / 256, 32 / 256,\r\n            //\r\n            0, 0,\r\n            //\r\n            32 / 256, 0,\r\n          ]\r\n        }, ])\r\n        .setInstanceAttributes(\r\n          \"instancePosition\",\r\n          \"instanceRotation\",\r\n          \"instanceScale\",\r\n          \"instanceFrame\",\r\n          \"instanceVisible\",\r\n          \"instanceBrightness\",\r\n          \"instanceAuraColor\"\r\n        )\r\n        .setUniforms(\r\n          \"vpMatrix\",\r\n          \"texture\",\r\n          \"globalScale\"\r\n        );\r\n\r\n      var instanceUnit = this.instanceStride / 4;\r\n      \r\n      var texture = phigl.Texture(gl, \"bullets.png\");\r\n\r\n      this.uniforms.texture.setValue(0).setTexture(texture);\r\n      this.uniforms.globalScale.setValue(1.0);\r\n\r\n      var instanceData = this.instanceData = [];\r\n      for (var i = 0; i < this._count; i++) {\r\n        instanceData.push(\r\n          // position\r\n          0, 0,\r\n          // rotation\r\n          0,\r\n          // scale\r\n          1,\r\n          // frame\r\n          0, 0,\r\n          // visible\r\n          0,\r\n          // brightness\r\n          0,\r\n          // auraColor\r\n          0, 0, 0\r\n        );\r\n      }\r\n      this.setInstanceAttributeData(instanceData);\r\n\r\n      var self = this;\r\n      this.pool = Array.range(0, this._count)\r\n        .map(function(id) {\r\n          return passion.Bullet(id, instanceData, instanceUnit)\r\n            .on(\"removed\", function() {\r\n              self.pool.add(this);\r\n            });\r\n        })\r\n        .toPool(function(lhs, rhs) {\r\n          return lhs.id - rhs.id;\r\n        });\r\n    },\r\n\r\n    get: function() {\r\n      return this.pool.get();\r\n    },\r\n\r\n    update: function(app) {\r\n      this.setInstanceAttributeData(this.instanceData);\r\n    },\r\n\r\n    render: function(uniforms) {\r\n      var gl = this.gl;\r\n      // gl.enable(gl.BLEND);\r\n      gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\r\n      // gl.disable(gl.DEPTH_TEST);\r\n\r\n      this.uniforms.globalScale.value = 1.0;\r\n      if (uniforms) {\r\n        uniforms.forIn(function(key, value) {\r\n          if (this.uniforms[key]) this.uniforms[key].value = value;\r\n        }.bind(this));\r\n      }\r\n\r\n      this.draw(this._count);\r\n    },\r\n  });\r\n\r\n});\r\n"," phina.namespace(function() {\r\n\r\n   phina.define(\"passion.CircleButton\", {\r\n     superClass: \"phina.display.Shape\",\r\n\r\n     init: function(options) {\r\n       this.superInit({}.$extend(options, {\r\n         width: options.radius * 2,\r\n         height: options.radius * 2,\r\n       }));\r\n\r\n       this.interactive = true;\r\n       this.boundingType = \"circle\";\r\n       this.radius = options.radius;\r\n       this.backgroundColor = \"transparent\";\r\n       this.fill = \"hsla(190, 100%, 60%, 0.4)\";\r\n       this.stroke = \"hsla(190, 100%, 60%, 0.9)\";\r\n       this.strokeWidth = 2;\r\n       this.fromJSON({\r\n         children: {\r\n           text: {\r\n             className: \"phina.display.Label\",\r\n             arguments: {\r\n               text: options.text,\r\n               fontSize: 24,\r\n               // fontWeight: \"bold\",\r\n               fontFamily: \"main\",\r\n             },\r\n             fill: \"hsla(190, 100%, 95%, 0.8)\",\r\n             strokeWidth: 0,\r\n           },\r\n         },\r\n       });\r\n     },\r\n\r\n     postrender: function(canvas) {\r\n       var c = canvas.context;\r\n\r\n       c.strokeStyle = \"hsla(190, 100%, 60%, 0.8)\";\r\n\r\n       c.beginPath();\r\n       c.arc(0, 0, this.radius * 0.65, 0, Math.PI * 2, false);\r\n       c.lineWidth = 1;\r\n       c.fill();\r\n       c.stroke();\r\n\r\n       c.beginPath();\r\n       c.arc(0, 0, this.radius * 0.75, 0, Math.PI * 2, false);\r\n       c.lineWidth = 3;\r\n       c.stroke();\r\n\r\n       c.strokeStyle = \"hsla(190, 100%, 60%, 0.8)\";\r\n       for (var a = 0, b; a < Math.PI * 2;) {\r\n         b = Math.randfloat(1.0, 2.0);\r\n         c.beginPath();\r\n         c.arc(0, 0, this.radius * 0.90, a, a + b, false);\r\n         c.lineWidth = 1;\r\n         c.stroke();\r\n         a += b * 1.5;\r\n       }\r\n\r\n       c.strokeStyle = \"hsla(190, 100%, 60%, 0.8)\";\r\n       for (var a = 0, b; a < Math.PI * 2;) {\r\n         b = Math.randfloat(1.0, 2.0);\r\n         c.beginPath();\r\n         c.arc(0, 0, this.radius * 1.00, a, a + b, false);\r\n         c.lineWidth = 1;\r\n         c.stroke();\r\n         a += b * 1.5;\r\n       }\r\n     },\r\n\r\n     onpointstart: function(e) {\r\n       this.scaleX = 1.2;\r\n       this.scaleY = 1.2;\r\n     },\r\n\r\n     onpointend: function(e) {\r\n       this.scaleX = 1.0;\r\n       this.scaleY = 1.0;\r\n       if (this.hitTest(e.pointer.x, e.pointer.y)) {\r\n         this.flare(\"clicked\");\r\n       }\r\n     },\r\n\r\n   });\r\n });\r\n","phina.namespace(function() {\r\n  \r\n  phina.define(\"passion.GLLayer\", {\r\n    superClass: \"phina.display.Layer\",\r\n\r\n    static: {\r\n      GL_CANVAS: null,\r\n      GL: null,\r\n    },\r\n\r\n    renderChildBySelf: true,\r\n    ready: false,\r\n\r\n    domElement: null,\r\n    gl: null,\r\n\r\n    camera: null,\r\n\r\n    bgDrawer: null,\r\n    enemyDrawer: null,\r\n    effectDrawer: null,\r\n    playerDrawer: null,\r\n    bulletDrawer: null,\r\n    topEffectDrawer: null,\r\n\r\n    init: function() {\r\n      this.superInit({\r\n        width: GAME_AREA_WIDTH,\r\n        height: GAME_AREA_HEIGHT,\r\n      });\r\n      this.originX = 0;\r\n      this.originY = 0;\r\n\r\n      if (passion.GLLayer.GL_CANVAS == null) {\r\n        passion.GLLayer.GL_CANVAS = document.createElement(\"canvas\");\r\n        passion.GLLayer.GL = passion.GLLayer.GL_CANVAS.getContext(\"webgl\");\r\n      }\r\n\r\n      this.domElement = passion.GLLayer.GL_CANVAS;\r\n      this.domElement.width = this.width * passion.GLLayer.quality;\r\n      this.domElement.height = this.height * passion.GLLayer.quality;\r\n\r\n      var gl = this.gl = passion.GLLayer.GL;\r\n      var extInstancedArrays = phigl.Extensions.getInstancedArrays(gl);\r\n\r\n      gl.viewport(0, 0, this.domElement.width, this.domElement.height);\r\n      gl.clearColor(0.0, 0.0, 0.0, 1.0);\r\n      gl.clearDepth(1.0);\r\n      gl.disable(gl.CULL_FACE);\r\n      gl.enable(gl.BLEND);\r\n      gl.disable(gl.DEPTH_TEST);\r\n\r\n      var cw = this.domElement.width;\r\n      var ch = this.domElement.height;\r\n      var w = this.width;\r\n      var h = this.height;\r\n      var sw = Math.pow(2, ~~Math.log2(cw) + 1);\r\n      var sh = Math.pow(2, ~~Math.log2(ch) + 1);\r\n\r\n      this.camera = passion.Camera()\r\n        .setPosition(w * 0.5, h * 0.5, 2000)\r\n        .lookAt(w * 0.5, h * 0.5, 0)\r\n        .ortho(-w * 0.5, w * 0.5, h * 0.5, -h * 0.5, 0.1, 3000)\r\n        .calcVpMatrix();\r\n\r\n      this.bgDrawer = passion.SpritDrawer(gl, extInstancedArrays, w, h);\r\n      this.enemyDrawer = passion.SpritDrawer(gl, extInstancedArrays, w, h);\r\n      this.effectDrawer = passion.SpritDrawer(gl, extInstancedArrays, w, h);\r\n      this.playerDrawer = passion.SpritDrawer(gl, extInstancedArrays, w, h);\r\n      this.bulletDrawer = passion.BulletDrawer(gl, extInstancedArrays, w, h);\r\n      this.topEffectDrawer = passion.SpritDrawer(gl, extInstancedArrays, w, h);\r\n\r\n      this.ready = true;\r\n    },\r\n\r\n    update: function(app) {\r\n      if (!this.ready) return;\r\n\r\n      this.bgDrawer.update(app);\r\n      this.enemyDrawer.update(app);\r\n      this.effectDrawer.update(app);\r\n      this.playerDrawer.update(app);\r\n      this.bulletDrawer.update(app);\r\n      this.topEffectDrawer.update(app);\r\n    },\r\n\r\n    draw: function(canvas) {\r\n      if (!this.ready) return;\r\n\r\n      var gl = this.gl;\r\n      var image = this.domElement;\r\n      var cw = image.width;\r\n      var ch = image.height;\r\n\r\n      var ou = this.camera.uniformValues();\r\n\r\n      gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n\r\n      this.bgDrawer.render(ou);\r\n      this.enemyDrawer.render(ou);\r\n      this.effectDrawer.render(ou);\r\n      this.playerDrawer.render(ou);\r\n      this.bulletDrawer.render(ou);\r\n      this.topEffectDrawer.render(ou);\r\n\r\n      gl.flush();\r\n\r\n      canvas.context.drawImage(image, 0, 0, cw, ch, 0, 0, this.width, this.height);\r\n    },\r\n\r\n    _static: {\r\n      // quality: 0.75,\r\n      quality: 1.0,\r\n    },\r\n  });\r\n\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"passion.Player\", {\r\n    superClass: \"passion.Sprite\",\r\n    \r\n    _roll: 0,\r\n\r\n    init: function(id, instanceData, instanceStride) {\r\n      this.superInit(id, instanceData, instanceStride);\r\n      this.on(\"enterframe\", function(e) {\r\n        this.controll(e.app);\r\n      });\r\n    },\r\n\r\n    spawn: function() {\r\n      passion.Sprite.prototype.spawn.call(this, {\r\n        scaleX: 60,\r\n        scaleY: 60,\r\n        frameX: 3 / 8,\r\n        frameY: 0 / 8,\r\n        frameW: 1 / 8,\r\n        frameH: 1 / 8,\r\n      });\r\n      return this;\r\n    },\r\n\r\n    controll: function(app) {\r\n      var p = app.pointer;\r\n      var dp = p.deltaPosition;\r\n\r\n      if (p.getPointing()) {\r\n        this.x += dp.x * 2;\r\n        this.y += dp.y * 2;\r\n\r\n        this.x = Math.clamp(this.x, 5, GAME_AREA_WIDTH - 5);\r\n        this.y = Math.clamp(this.y, 5, GAME_AREA_HEIGHT - 5);\r\n      }\r\n    },\r\n    \r\n    acceccor: {\r\n      roll: {\r\n        get: function() {\r\n          return this._roll;\r\n        },\r\n        set: function(v) {\r\n          this._roll = Math.clamp(v, -3, 3);\r\n          var r = ~~this._roll;\r\n          if (-3 < r && r < 0) r += 1;\r\n          this.frameX = (r + 3) / 8;\r\n        },\r\n      },\r\n    },\r\n\r\n  });\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"passion.SpritDrawer\", {\r\n    superClass: \"phigl.InstancedDrawable\",\r\n\r\n    objTypes: null,\r\n    objParameters: null,\r\n\r\n    init: function(gl, ext, w, h) {\r\n      this.superInit(gl, ext);\r\n\r\n      this.objTypes = [];\r\n      this.objParameters = {};\r\n\r\n      var shader = phigl.Program(gl)\r\n        .attach(\"sprites.vs\")\r\n        .attach(\"sprites.fs\")\r\n        .link();\r\n\r\n      this\r\n        .setProgram(shader)\r\n        .setDrawMode(gl.TRIANGLE_STRIP)\r\n        .setIndexValues([0, 1, 2, 3])\r\n        .setAttributes(\"position\", \"uv\")\r\n        .setAttributeDataArray([{\r\n          unitSize: 2,\r\n          data: [\r\n            //\r\n            -0.5, +0.5,\r\n            //\r\n            +0.5, +0.5,\r\n            //\r\n            -0.5, -0.5,\r\n            //\r\n            +0.5, -0.5,\r\n          ]\r\n        }, {\r\n          unitSize: 2,\r\n          data: [\r\n            //\r\n            0, 1,\r\n            //\r\n            1, 1,\r\n            //\r\n            0, 0,\r\n            //\r\n            1, 0,\r\n          ]\r\n        }, ])\r\n        .setInstanceAttributes(\r\n          \"instanceVisible\",\r\n          \"instancePosition\",\r\n          \"instanceRotation\",\r\n          \"instanceScale\",\r\n          \"instanceFrame\",\r\n          \"instanceColor\"\r\n        )\r\n        .setUniforms(\r\n          \"vpMatrix\",\r\n          \"texture\",\r\n          \"globalScale\"\r\n        );\r\n\r\n      var instanceStride = this.instanceStride / 4;\r\n\r\n      this.uniforms.globalScale.setValue(1.0);\r\n    },\r\n\r\n    addObjType: function(objName, options) {\r\n      options = {}.$extend({\r\n        className: \"passion.Sprite\",\r\n        count: 1,\r\n        texture: null,\r\n        additiveBlending: false,\r\n      }, options);\r\n\r\n      if (!this.objTypes.contains(objName)) {\r\n        var self = this;\r\n        var instanceStride = this.instanceStride / 4;\r\n\r\n        this.objTypes.push(objName);\r\n        var objParameter = this.objParameters[objName] = {\r\n          count: options.count,\r\n          instanceVbo: phigl.Vbo(this.gl, this.gl.DYNAMIC_DRAW),\r\n          texture: phigl.Texture(this.gl, options.texture),\r\n          pool: null,\r\n          additiveBlending: options.additiveBlending,\r\n          instanceData: Array.range(options.count).map(function(i) {\r\n            return [\r\n              // visible\r\n              0,\r\n              // position\r\n              0, 0,\r\n              // rotation\r\n              0,\r\n              // scale\r\n              0, 0,\r\n              // frame\r\n              0, 0, 0, 0,\r\n              // rgba\r\n              0, 0, 0, 0,\r\n            ];\r\n          }).flatten(),\r\n        };\r\n\r\n        var ObjClass = phina.using(options.className);\r\n        objParameter.pool = Array.range(options.count).map(function(id) {\r\n          return ObjClass(id, objParameter.instanceData, instanceStride)\r\n            .on(\"removed\", function() {\r\n              objParameter.pool.push(this);\r\n            });\r\n        });\r\n      }\r\n    },\r\n\r\n    get: function(objName) {\r\n      return this.objParameters[objName].pool.shift();\r\n    },\r\n\r\n    update: function() {},\r\n\r\n    render: function(uniforms) {\r\n      if (this.objTypes.length === 0) return;\r\n\r\n      var gl = this.gl;\r\n      // gl.enable(gl.BLEND);\r\n      // gl.disable(gl.DEPTH_TEST);\r\n\r\n      this.uniforms.globalScale.value = 1.0;\r\n\r\n      if (uniforms) {\r\n        uniforms.forIn(function(key, value) {\r\n          if (this.uniforms[key]) this.uniforms[key].value = value;\r\n        }.bind(this));\r\n      }\r\n      var self = this;\r\n      this.objTypes.forEach(function(objName) {\r\n        var objParameter = self.objParameters[objName];\r\n\r\n        if (objParameter.additiveBlending) {\r\n          gl.blendFunc(gl.SRC_ALPHA, gl.ONE);\r\n        } else {\r\n          gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\r\n        }\r\n\r\n        self.setInstanceAttributeVbo(\r\n          objParameter.instanceVbo.set(objParameter.instanceData)\r\n        );\r\n        self.uniforms.texture.setValue(0).setTexture(objParameter.texture);\r\n        self.draw(objParameter.count);\r\n      });\r\n    },\r\n  });\r\n\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"passion.Sprite\", {\r\n    superClass: \"phina.app.Element\",\r\n\r\n    id: -1,\r\n    instanceData: null,\r\n\r\n    visible: true,\r\n\r\n    x: 0,\r\n    y: 0,\r\n    rotation: 0,\r\n    scale: 0,\r\n\r\n    frameX: 0,\r\n    frameY: 0,\r\n    frameW: 0,\r\n    frameH: 0,\r\n\r\n    red: 1.0,\r\n    green: 1.0,\r\n    blue: 1.0,\r\n    alpha: 1.0,\r\n\r\n    age: 0,\r\n\r\n    init: function(id, instanceData, instanceStride) {\r\n      this.superInit();\r\n      this.id = id;\r\n      this.instanceData = instanceData;\r\n      this.index = id * instanceStride;\r\n    },\r\n\r\n    spawn: function(options) {\r\n      options.$safe({\r\n        visible: true,\r\n        x: 0,\r\n        y: 0,\r\n        rotation: 0,\r\n        scaleX: 1,\r\n        scaleY: 1,\r\n        frameX: 0,\r\n        frameY: 0,\r\n        frameW: 1 / 8,\r\n        frameH: 1 / 8,\r\n        red: 1.0,\r\n        green: 1.0,\r\n        blue: 1.0,\r\n        alpha: 1.0,\r\n      });\r\n\r\n      var index = this.index;\r\n      var instanceData = this.instanceData;\r\n\r\n      this.visible = options.visible;\r\n      this.x = options.x;\r\n      this.y = options.y;\r\n      this.rotation = options.rotation;\r\n      this.scaleX = options.scaleX;\r\n      this.scaleY = options.scaleY;\r\n      this.frameX = options.frameX;\r\n      this.frameY = options.frameY;\r\n      this.frameW = options.frameW;\r\n      this.frameH = options.frameH;\r\n      this.red = options.red;\r\n      this.green = options.green;\r\n      this.blue = options.blue;\r\n      this.alpha = options.alpha;\r\n\r\n      instanceData[index + 0] = this.visible ? 1 : 0; // visible\r\n      instanceData[index + 1] = this.x; // position.x\r\n      instanceData[index + 2] = this.y; // position.y\r\n      instanceData[index + 3] = this.rotation; // rotation\r\n      instanceData[index + 4] = this.scaleX; // scale\r\n      instanceData[index + 5] = this.scaleY; // scale\r\n      instanceData[index + 6] = this.frameX; // frame.x\r\n      instanceData[index + 7] = this.frameY; // frame.y\r\n      instanceData[index + 8] = this.frameW; // frame.w\r\n      instanceData[index + 9] = this.frameH; // frame.h\r\n      instanceData[index + 10] = this.red; // red\r\n      instanceData[index + 11] = this.green; // green\r\n      instanceData[index + 12] = this.blue; // blue\r\n      instanceData[index + 13] = this.alpha; // alpha\r\n\r\n      this.age = 0;\r\n\r\n      return this;\r\n    },\r\n\r\n    update: function(app) {\r\n      var index = this.index;\r\n      var instanceData = this.instanceData;\r\n\r\n      instanceData[index + 0] = this.visible ? 1 : 0; // visible\r\n      instanceData[index + 1] = this.x; // position.x\r\n      instanceData[index + 2] = this.y; // position.y\r\n      instanceData[index + 3] = this.rotation; // rotation\r\n      instanceData[index + 4] = this.scaleX; // scale\r\n      instanceData[index + 5] = this.scaleY; // scale\r\n      instanceData[index + 6] = this.frameX; // frame.x\r\n      instanceData[index + 7] = this.frameY; // frame.y\r\n      instanceData[index + 8] = this.frameW; // frame.w\r\n      instanceData[index + 9] = this.frameH; // frame.h\r\n      instanceData[index + 10] = this.red; // red\r\n      instanceData[index + 11] = this.green; // green\r\n      instanceData[index + 12] = this.blue; // blue\r\n      instanceData[index + 13] = this.alpha; // alpha\r\n\r\n      this.age += 1;\r\n    },\r\n\r\n    onremoved: function() {\r\n      this.visible = false;\r\n      this.instanceData[this.index + 0] = 0;\r\n    },\r\n  });\r\n\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"passion.UIFrame\", {\r\n    superClass: \"phina.display.Shape\",\r\n\r\n    init: function(options) {\r\n      this.superInit(options);\r\n      this.backgroundColor = \"transparent\";\r\n      this.strokeWidth = 2;\r\n    },\r\n\r\n    prerender: function(canvas) {\r\n      var c = canvas.context;\r\n\r\n      c.beginPath();\r\n      c.moveTo(-this.width / 2 + 10, -this.height / 2);\r\n      c.lineTo(this.width / 2 - 5, -this.height / 2);\r\n      c.lineTo(this.width / 2, -this.height / 2 + 5);\r\n      c.lineTo(this.width / 2, this.height / 2 - 10);\r\n      c.lineTo(this.width / 2 - 10, this.height / 2);\r\n      c.lineTo(-this.width / 2 + 35, this.height / 2);\r\n      c.lineTo(-this.width / 2 + 30, this.height / 2 - 5);\r\n      c.lineTo(-this.width / 2, this.height / 2 - 5);\r\n      c.lineTo(-this.width / 2, 10 - this.height / 2);\r\n      c.closePath();\r\n\r\n      var sg = c.createLinearGradient(this.height / 2, -this.width / 2, -this.height / 2, this.width / 2);\r\n      sg.addColorStop(0.00, \"hsla(190, 100%, 30%, 0.8)\");\r\n      sg.addColorStop(0.38, \"hsla(190, 100%, 30%, 0.8)\");\r\n      sg.addColorStop(0.48, \"hsla(190, 100%, 80%, 0.8)\");\r\n      sg.addColorStop(0.52, \"hsla(190, 100%, 80%, 0.8)\");\r\n      sg.addColorStop(0.62, \"hsla(190, 100%, 30%, 0.8)\");\r\n      sg.addColorStop(1.00, \"hsla(190, 100%, 30%, 0.8)\");\r\n      this.stroke = sg;\r\n\r\n      var fg = c.createLinearGradient(this.height / 2, -this.width / 2, -this.height / 2, this.width / 2);\r\n      fg.addColorStop(0.00, \"hsla(210, 100%, 30%, 0.2)\");\r\n      fg.addColorStop(0.38, \"hsla(210, 100%, 30%, 0.2)\");\r\n      fg.addColorStop(0.48, \"hsla(210, 100%, 80%, 0.2)\");\r\n      fg.addColorStop(0.52, \"hsla(210, 100%, 80%, 0.2)\");\r\n      fg.addColorStop(0.62, \"hsla(210, 100%, 30%, 0.2)\");\r\n      fg.addColorStop(1.00, \"hsla(210, 100%, 30%, 0.2)\");\r\n      this.fill = fg;\r\n    },\r\n\r\n    postrender: function(canvas) {\r\n      var c = canvas.context;\r\n\r\n      c.beginPath();\r\n      c.moveTo(-this.width / 2 + 10 - 3, -this.height / 2 - 3);\r\n      c.lineTo(this.width / 2 - 5 + 3, -this.height / 2 - 3);\r\n      c.lineTo(this.width / 2 + 3, -this.height / 2 + 5 - 3);\r\n      c.lineTo(this.width / 2 + 3, this.height / 2 - 10 + 3);\r\n      c.lineTo(this.width / 2 - 10 + 3, this.height / 2 + 3);\r\n      c.lineTo(-this.width / 2 + 35 - 3, this.height / 2 + 3);\r\n      c.lineTo(-this.width / 2 + 30 - 3, this.height / 2 - 5 + 3);\r\n      c.lineTo(-this.width / 2 - 3, this.height / 2 - 5 + 3);\r\n      c.lineTo(-this.width / 2 - 3, -this.height / 2 + 10 - 3);\r\n      c.closePath();\r\n\r\n      c.lineWidth = 1;\r\n      c.stroke();\r\n    },\r\n\r\n  });\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"passion.UILayer\", {\r\n    superClass: \"phina.display.DisplayElement\",\r\n\r\n    init: function() {\r\n      this.superInit();\r\n      this.fromJSON({\r\n        originX: 0,\r\n        originY: 0,\r\n        children: {\r\n          scoreBg: {\r\n            className: \"passion.UIFrame\",\r\n            arguments: {\r\n              width: GAME_AREA_WIDTH * 0.96,\r\n              height: GAME_AREA_HEIGHT * 0.05,\r\n            },\r\n            x: GAME_AREA_WIDTH * 0.01,\r\n            y: GAME_AREA_HEIGHT * 0.00,\r\n            originX: 0,\r\n            originY: 0,\r\n            children: {\r\n              scoreLabel: {\r\n                className: \"phina.display.Label\",\r\n                arguments: {\r\n                  text: \"1,234,567,890\",\r\n                  align: \"right\",\r\n                  baseline: \"middle\",\r\n                  fontSize: GAME_AREA_HEIGHT * 0.04,\r\n                },\r\n                x: GAME_AREA_WIDTH * 0.96,\r\n                y: GAME_AREA_HEIGHT * 0.04,\r\n              },\r\n            },\r\n          },\r\n          button: {\r\n            className: \"passion.CircleButton\",\r\n            arguments: {\r\n              text: \"B\",\r\n              radius: GAME_AREA_WIDTH * 0.08,\r\n            },\r\n            x: GAME_AREA_WIDTH * 0.10,\r\n            y: GAME_AREA_HEIGHT * 0.94,\r\n          },\r\n          damage: {\r\n            className: \"phina.display.Sprite\",\r\n            arguments: this.damageTexture(),\r\n            originX: 0,\r\n            originY: 0,\r\n            alpha: 0.0,\r\n          },\r\n        },\r\n      });\r\n    },\r\n\r\n    damageTexture: function() {\r\n      var c = phina.graphics.Canvas();\r\n      c.setSize(GAME_AREA_WIDTH, GAME_AREA_HEIGHT);\r\n      c.clearColor(\"transparent\");\r\n      var g = c.context.createRadialGradient(GAME_AREA_WIDTH / 2, GAME_AREA_HEIGHT / 2, 0, GAME_AREA_WIDTH / 2, GAME_AREA_HEIGHT / 2, GAME_AREA_HEIGHT / 2)\r\n      g.addColorStop(0, \"rgba(255, 0, 0, 0.0)\");\r\n      g.addColorStop(1, \"rgba(255, 0, 0, 1.0)\");\r\n      c.fillStyle = g;\r\n      c.fillRect(0, 0, GAME_AREA_WIDTH, GAME_AREA_HEIGHT);\r\n      return c;\r\n    },\r\n\r\n  });\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"passion.Pool\", {\r\n\r\n    array: null,\r\n    dirty: null,\r\n    comparator: null,\r\n\r\n    init: function(array, comparator) {\r\n      this.array = array || [];\r\n      this.comparator = comparator || function(lhs, rhs) {\r\n        return lhs - rhs;\r\n      };\r\n      this.dirty = true;\r\n    },\r\n\r\n    add: function(obj) {\r\n      this.array.push(obj);\r\n      this.dirty = true;\r\n    },\r\n\r\n    get: function() {\r\n      if (this.dirty) {\r\n        this.array.sort(this.comparator);\r\n        this.dirty = false;\r\n      }\r\n      return this.array.shift();\r\n    },\r\n  });\r\n\r\n  Array.prototype.$method(\"toPool\", function(comparator) {\r\n    return passion.Pool(this, comparator);\r\n  });\r\n\r\n});\r\n","phina.namespace(function() {\r\n\r\n  phina.define(\"passion.GameScene\", {\r\n    superClass: \"phina.display.DisplayScene\",\r\n\r\n    init: function() {\r\n      this.superInit();\r\n\r\n      this.fromJSON({\r\n        children: {\r\n          bg: {\r\n            className: \"phina.display.Sprite\",\r\n            arguments: this.drawBgTexture(),\r\n            originX: 0,\r\n            originY: 0,\r\n          },\r\n          glLayer: {\r\n            className: \"passion.GLLayer\",\r\n          },\r\n          uiLayer: {\r\n            className: \"passion.UILayer\",\r\n          },\r\n        },\r\n      });\r\n\r\n      this.glLayer.bgDrawer.addObjType(\"bg\", {\r\n        className: \"passion.Background\",\r\n        texture: \"test.png\",\r\n        count: 2,\r\n      });\r\n      var bg = this.glLayer.bgDrawer.get(\"bg\");\r\n      bg.spawn();\r\n      bg.x = GAME_AREA_WIDTH / 2;\r\n      bg.y = GAME_AREA_HEIGHT / 2;\r\n      bg.addChildTo(this.glLayer);\r\n      var bg2 = this.glLayer.bgDrawer.get(\"bg\");\r\n      bg2.spawn();\r\n      bg2.x = GAME_AREA_WIDTH / 2;\r\n      bg2.y = GAME_AREA_HEIGHT / 2 - 640;\r\n      bg2.addChildTo(this.glLayer);\r\n\r\n      this.glLayer.effectDrawer.addObjType(\"effect\", {\r\n        texture: \"texture0.png\",\r\n        additiveBlending: true,\r\n        count: 500,\r\n      });\r\n      this.on(\"enterframe\", function(e) {\r\n        if (e.app.ticker.frame % 2 !== 0) return;\r\n        var hex = this.glLayer.effectDrawer.get(\"effect\");\r\n        if (hex) {\r\n          var dx = Math.randfloat(-1, 1);\r\n          hex.onenterframe = function() {\r\n            this.x += dx;\r\n            this.y += 2;\r\n            this.alpha *= 0.9;\r\n            if (this.alpha < 0.01) {\r\n              this.remove();\r\n            }\r\n          };\r\n          var s = Math.randfloat(22, 32);\r\n          hex.spawn({\r\n            scaleX: s,\r\n            scaleY: s,\r\n            frameX: 7 / 8,\r\n            frameY: 0 / 8,\r\n            frameW: 1 / 8,\r\n            frameH: 1 / 8,\r\n            red: 0.2,\r\n            green: 1.0,\r\n            blue: 0.8,\r\n            alpha: 1.0,\r\n          });\r\n          hex.addChildTo(this.glLayer);\r\n          hex.x = player.x;\r\n          hex.y = player.y + 15;\r\n        }\r\n      });\r\n\r\n      this.glLayer.playerDrawer.addObjType(\"player\", {\r\n        className: \"passion.Player\",\r\n        texture: \"texture0.png\",\r\n      });\r\n\r\n      var player = this.glLayer.playerDrawer.get(\"player\");\r\n      player.spawn();\r\n      player.addChildTo(this.glLayer);\r\n      player.x = 100;\r\n      player.y = 100;\r\n\r\n      this.glLayer.topEffectDrawer.addObjType(\"effect\", {\r\n        texture: \"texture0.png\",\r\n        count: 2,\r\n        // additiveBlending: true,\r\n      });\r\n      var marker1 = this.glLayer.topEffectDrawer.get(\"effect\");\r\n      marker1.spawn({\r\n        scaleX: 14,\r\n        scaleY: 14,\r\n        frameX: 7 / 8,\r\n        frameY: 0 / 8,\r\n        frameW: 1 / 8,\r\n        frameH: 1 / 8,\r\n        red: 0.4,\r\n        green: 2.0,\r\n        blue: 1.6,\r\n        alpha: 1.0,\r\n      });\r\n      marker1.addChildTo(this.glLayer);\r\n      marker1.on(\"enterframe\", function() {\r\n        this.x = player.x;\r\n        this.y = player.y;\r\n        this.rotation += 0.1;\r\n      });\r\n      var marker2 = this.glLayer.topEffectDrawer.get(\"effect\");\r\n      marker2.spawn({\r\n        scaleX: 8,\r\n        scaleY: 8,\r\n        frameX: 7 / 8,\r\n        frameY: 0 / 8,\r\n        frameW: 1 / 8,\r\n        frameH: 1 / 8,\r\n        red: 0.4,\r\n        green: 2.0,\r\n        blue: 1.6,\r\n        alpha: 1.0,\r\n        rotation: 0.5,\r\n      });\r\n      marker2.addChildTo(this.glLayer);\r\n      marker2.on(\"enterframe\", function() {\r\n        this.x = player.x;\r\n        this.y = player.y;\r\n        this.rotation += 0.1;\r\n      });\r\n      var marker3 = this.glLayer.effectDrawer.get(\"effect\");\r\n      marker3.spawn({\r\n        scaleX: 80,\r\n        scaleY: 80,\r\n        frameX: 0 / 8,\r\n        frameY: 1 / 8,\r\n        frameW: 1 / 8,\r\n        frameH: 1 / 8,\r\n        red: 2.0,\r\n        green: 2.0,\r\n        blue: 2.0,\r\n        alpha: 0.3,\r\n      });\r\n      marker3.addChildTo(this.glLayer);\r\n      marker3.on(\"enterframe\", function() {\r\n        this.x = player.x;\r\n        this.y = player.y;\r\n      });\r\n\r\n      bulletml.dsl();\r\n      var ptn = new bulletml.Root({\r\n        top0: action([\r\n          repeat(Infinity, [\r\n            repeat(50, [\r\n              fire(bullet({ type: 9 }), direction(7, \"sequence\"), speed(3.0)),\r\n              fire(bullet({ type: 1 }), direction(90, \"sequence\"), speed(2.0)),\r\n              fire(bullet({ type: 9 }), direction(90, \"sequence\"), speed(3.0)),\r\n              fire(bullet({ type: 1 }), direction(90, \"sequence\"), speed(2.0)),\r\n              fire(bullet({ type: 9 }), direction(90, \"sequence\"), speed(3.0)),\r\n              wait(1),\r\n            ]),\r\n            wait(120),\r\n          ]),\r\n        ]),\r\n      });\r\n\r\n      var glLayer = this.glLayer;\r\n      var bulletDrawer = this.glLayer.bulletDrawer;\r\n\r\n      var runner = ptn.createRunner({\r\n        target: player,\r\n        createNewBullet: function(runner, spec) {\r\n          var b = bulletDrawer.get();\r\n          if (b) {\r\n            b.spawn(runner, {\r\n              type: spec.type,\r\n              scale: 32,\r\n            });\r\n            b.addChildTo(glLayer);\r\n          }\r\n        },\r\n      });\r\n      player.on(\"enterframe\", function() {\r\n        runner.x = this.x;\r\n        runner.y = this.y;\r\n        runner.update();\r\n      });\r\n    },\r\n\r\n    drawBgTexture: function() {\r\n      var bgTexture = phina.graphics.Canvas();\r\n      bgTexture.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);\r\n      bgTexture.clearColor(\"hsla(190, 100%, 95%, 0.1)\");\r\n      (150).times(function(i, j) {\r\n        var y = (SCREEN_HEIGHT * 1.5) / j * i;\r\n        bgTexture.strokeStyle = \"hsla(190, 100%, 95%, 0.2)\";\r\n        bgTexture.strokeLines(\r\n          SCREEN_WIDTH * 0.0, y - 10,\r\n          SCREEN_WIDTH * 0.1, y - 10,\r\n          SCREEN_WIDTH * 0.2, y + 20,\r\n          SCREEN_WIDTH * 0.5, y + 20,\r\n          SCREEN_WIDTH * 0.6, y - 30,\r\n          SCREEN_WIDTH * 0.7, y - 30,\r\n          SCREEN_WIDTH * 0.8, y - 50,\r\n          SCREEN_WIDTH * 1.0, y - 50\r\n        );\r\n        bgTexture.strokeStyle = \"hsla(190, 100%, 65%, 0.2)\";\r\n        y += 1;\r\n        bgTexture.strokeLines(\r\n          SCREEN_WIDTH * 0.0, y - 10,\r\n          SCREEN_WIDTH * 0.1, y - 10,\r\n          SCREEN_WIDTH * 0.2, y + 20,\r\n          SCREEN_WIDTH * 0.5, y + 20,\r\n          SCREEN_WIDTH * 0.6, y - 30,\r\n          SCREEN_WIDTH * 0.7, y - 30,\r\n          SCREEN_WIDTH * 0.8, y - 50,\r\n          SCREEN_WIDTH * 1.0, y - 50\r\n        );\r\n        bgTexture.strokeStyle = \"hsla(190, 100%, 35%, 0.2)\";\r\n        y += 1;\r\n        bgTexture.strokeLines(\r\n          SCREEN_WIDTH * 0.0, y - 10,\r\n          SCREEN_WIDTH * 0.1, y - 10,\r\n          SCREEN_WIDTH * 0.2, y + 20,\r\n          SCREEN_WIDTH * 0.5, y + 20,\r\n          SCREEN_WIDTH * 0.6, y - 30,\r\n          SCREEN_WIDTH * 0.7, y - 30,\r\n          SCREEN_WIDTH * 0.8, y - 50,\r\n          SCREEN_WIDTH * 1.0, y - 50\r\n        );\r\n      });\r\n      return bgTexture;\r\n    },\r\n\r\n  });\r\n});\r\n"],"sourceRoot":"/source/"}